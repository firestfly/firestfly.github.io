<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>项目相关脚本</comment>

    <!-- 根据项目名称,模糊查询项目信息 取前二十条记录 -->
    <entry key="sql.query.project.by.projectName">
    <![CDATA[
    SELECT
        p.id,
        p.oldId,
        p.name,
        p.shortName,
        p.code,
        p.address,
        p.isOuter
    FROM
        main_project p
    WHERE IFNULL(p.isDeleted, 0) = 0
       {?AND p.name LIKE CONCAT(CONCAT('%', #projectName#), '%') ESCAPE '/'}
             
    ORDER BY p.name
    LIMIT 20
	]]>
    </entry>
    
    <!-- 根据项目名称,模糊查询项目信息 取前二十条记录 带权限 -->
    <entry key="sql.query.roleproject.by.projectName">
    <![CDATA[
		SELECT p.id, p.oldId, p. NAME, p.shortName, p. CODE, p.address, p.isOuter
		  FROM main_project p
		 INNER JOIN mid_organization_user su1
		    ON su1.organizationId = p.id
		    INNER JOIN tree_organization tro
	        ON tro.id=p.id
		   AND su1.isdeleted = 0
		   AND su1. STATUS = 1
		   AND su1.userId = #userId#
		 WHERE IFNULL(p.isDeleted, 0) = 0
		 {? AND p.name LIKE CONCAT(CONCAT('%', #projectName#), '%') ESCAPE '/'}
		 {? AND p.cityCode = #cityCode# }
		 {? AND tro.parentId = #parentId# }
		 ORDER BY p.NAME -- LIMIT 20
	]]>
    </entry>

    <!-- 根据项目ID获取该项目下所有的楼栋 -->
    <entry key="sql.query.building.by.projectId">
        <![CDATA[
        SELECT
            id, name
        FROM
            tree_organization
        WHERE
            levelType = 5 AND parentId = #projectId#
    ]]>
    </entry>

    <!-- 根据项目ID获取该项目楼栋信息用于报表（加了网格过滤） -->
    <entry key="sql.query.building.report">
        <![CDATA[
        SELECT
            id, name
        FROM
            tree_organization
        WHERE
            levelType = 5 AND parentId = #projectId#
             {? AND id IN (SELECT buildingId FROM mid_project_house WHERE gridId = #gridId#) }
    ]]>
    </entry>


    <!-- 根据楼栋获取房屋信息用于报表（加了网格过滤） -->
    <entry key="sql.query.house.report">
        <![CDATA[
        select b.id,b.code,b.name  from mid_project_house a LEFT JOIN main_house b on b.id=a.houseId
        where  1=1
        and b.buildingCode = #buildingCode#
        {? and a.gridId = #gridId#}
    ]]>
    </entry>

</properties>