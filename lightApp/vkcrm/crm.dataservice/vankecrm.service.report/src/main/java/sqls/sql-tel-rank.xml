<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <comment>呼叫排行榜相关SQL</comment>

    <!-- 呼出量 -->
    <entry key="sql.tel.rank.callOutCount">
        <![CDATA[
    SELECT
    count(1) AS callOutCount ,
    tcr.telephonist,
    tcr.telephonistId,
    NOW() AS stateTime
    FROM tel_call_records tcr
    LEFT JOIN tel_telecomno tt ON tt.telephonistId = tcr.telephonistId
    WHERE 1 = 1
    AND tcr.type = 2
    AND tcr.telephonistId IS NOT NULL
    AND tcr.telephonist IS NOT NULL
    {? AND DATE_FORMAT(tcr.callTime,'%Y-%m-%d') = #currentDay#}
    {? AND tcr.callTime BETWEEN #firstDay# AND #lastDay#}
    {? AND tt.skillid = #skillId#}
    GROUP BY telephonistId
    ]]>
    </entry>

    <!-- 接通量 -->
    <entry key="sql.tel.rank.connectedCount">
        <![CDATA[
    SELECT
    count(1) AS connectedCount ,
    tcr.telephonist,
    tcr.telephonistId,
    NOW() AS stateTime
    FROM tel_call_records  tcr
    LEFT JOIN tel_telecomno tt ON tt.telephonistId = tcr.telephonistId
    WHERE 1 = 1
    AND tcr.type = 2
    AND tcr.duration > 3
    AND tcr.telephonistId IS NOT NULL
    AND tcr.telephonist IS NOT NULL
    {? AND DATE_FORMAT(tcr.callTime,'%Y-%m-%d') = #currentDay#}
    {? AND tcr.callTime BETWEEN #firstDay# AND #lastDay#}
    {? AND tt.skillid = #skillId#}
    GROUP BY telephonistId]]>
    </entry>

    <!-- 成功量 -->
    <entry key="sql.tel.rank.succeededCount">
        <![CDATA[
    SELECT
    count(1) AS succeededCount ,
    tcr.telephonist,
    tcr.telephonistId,
    NOW() AS stateTime
    FROM
    tel_call_records AS tcr
    LEFT JOIN tel_telecomno tt ON tt.telephonistId = tcr.telephonistId
    LEFT JOIN mid_answer_callrecords mac ON mac.callrecord_id = tcr.callId
    LEFT JOIN biz_answer ba ON ba.answer_id = mac.answer_id
    WHERE 1 = 1
    AND tcr.type = 2
    AND ba.completed = 1
    AND tcr.telephonistId IS NOT NULL
    AND tcr.telephonist IS NOT NULL
    {? AND DATE_FORMAT(tcr.callTime,'%Y-%m-%d') = #currentDay#}
    {? AND tcr.callTime BETWEEN #firstDay# AND #lastDay#}
    {? AND tt.skillid = #skillId#}
    GROUP BY tcr.telephonistId
    ]]>
    </entry>

    <!-- 未接通量  -->
    <entry key="sql.tel.rank.unConnectCount">
        <![CDATA[
    SELECT
    count(1) AS unConnectCount,
    tcr.telephonist,
    tcr.telephonistId,
    NOW() AS stateTime
    FROM tel_call_records  tcr
    LEFT JOIN tel_telecomno tt ON tt.telephonistId = tcr.telephonistId
    WHERE 1 = 1
    AND tcr.type = 2
    AND tcr.duration <= 3
    AND tcr.telephonistId IS NOT NULL
    AND tcr.telephonist IS NOT NULL
    {? AND DATE_FORMAT(tcr.callTime,'%Y-%m-%d') = #currentDay#}
    {? AND tcr.callTime BETWEEN #firstDay# AND #lastDay#}
    {? AND tt.skillid = #skillId#}
    GROUP BY telephonistId
    ]]>
    </entry>

</properties>