<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <comment>问卷sql</comment>

    <entry key="sql.select.questionnaire">
        <![CDATA[
        SELECT
        bq.questionnaire_id,
        bq.subject_id,
        bq.title,
        bq.sample_ratio,
        bq.annual_complete_rate,
        bq.begin_time,
        bq.end_time,
        bq.delay_time,
        bq.description,
        bq.enabled,
        bq.status,
        CASE WHEN bq.begin_time > NOW() AND NOW() < bq.end_time AND NOW() <  bq.delay_time
        THEN 'true'
        ELSE 'false' END AS crossTime,
        (SELECT COUNT(*) FROM biz_topics WHERE questionnaire_id = bq.questionnaire_id AND deleted = 0) AS topicCount,
        bq.exclude_specialidentities
        FROM biz_questionnaire bq
        WHERE 1 =1
        AND bq.deleted = 0
        AND questionnaire_id = #QuestionnaireId#
        ]]>
    </entry>

    <entry key="sql.select.questionnaires">
        <![CDATA[
        SELECT
        bq.questionnaire_id,
        bq.title,
        bq.sample_ratio,
        bq.annual_complete_rate,
        bq.begin_time,
        bq.end_time,
        bq.delay_time,
        bq.description,
        bq.enabled,
        bq.status,
        CASE WHEN bq.begin_time > NOW() AND NOW() < bq.end_time AND NOW() <  bq.delay_time
        THEN 'true'
        ELSE 'false' END AS crossTime,
        (SELECT COUNT(*) FROM biz_topics WHERE questionnaire_id = bq.questionnaire_id AND deleted = 0) AS topicCount
        FROM biz_questionnaire bq
        WHERE 1 =1
        AND bq.deleted = 0
        ORDER BY bq.ctime desc
        ]]>
    </entry>

    <entry key="sql.update.questionnaire.deleted">
        UPDATE biz_questionnaire
        SET deleted  = 1,
            duid = #UserId#,
            dtime = Now()
        WHERE 1 = 1
        AND questionnaire_id = #QuestionnaireId#
    </entry>

    <entry key="sql.update.questionnaire.enabled">
        UPDATE biz_questionnaire
        SET enabled  = #IsEnabled#,
        muid = #UserId#,
        mtime = Now()
        WHERE 1 = 1
        AND questionnaire_id = #QuestionnaireId#
    </entry>

    <entry key="sql.update.questionnaire.status">
        UPDATE biz_questionnaire
        SET status  = #Status#,
        muid = #UserId#,
        mtime = Now()
        WHERE 1 = 1
        AND questionnaire_id = #QuestionnaireId#
    </entry>

    <entry key="sql.insert.questionnaire">
        INSERT INTO biz_questionnaire
        (
        questionnaire_id,
        subject_id,
        title,
        sample_ratio,
        annual_complete_rate,
        begin_time,
        end_time,
        delay_time,
        description,
        exclude_specialidentities,
        enabled,
        cuid,
        ctime)
        VALUES(
        #id#,
        #subjectId#,
        #title#,
        #sampleRatio#,
        #annualCompleteRate#,
        #beginTime#,
        #endTime#,
        #delayTime#,
        #description#,
        #excludeSpecialIdentities#,
        #enabled#,
        #creatorId#,
        Now()
        )
    </entry>

    <entry key="sql.update.questionnaire">
        UPDATE biz_questionnaire
        SET
        {? subject_id = #subjectId#,}
        {? title = #title#,}
        {? sample_ratio = #sampleRatio#,}
        {? annual_complete_rate = #annualCompleteRate#,}
        {? begin_time = #beginTime#,}
        {? end_time = #endTime#,}
        {? delay_time = #delayTime#,}
        {? description = #description#,}
        {? enabled = #enabled#,}
        {? exclude_specialidentities = #excludeSpecialIdentities#,}
        muid = #modifierId#,
        mtime = Now()
        WHERE 1 = 1
        AND questionnaire_id = #id#
    </entry>
</properties>
