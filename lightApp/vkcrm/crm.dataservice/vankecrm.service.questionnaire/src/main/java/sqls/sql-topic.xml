<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <comment>题目sql</comment>

    <!-- 查询题目列表 -->
    <entry key="sql.select.topics">
        SELECT
        bt.topic_id,
        bt.questionnaire_id,
        bt.title,
        bt.weight,
        bt.target,
        bt.sequence,
        bt.option_mode,
        (SELECT COUNT(*) FROM biz_options WHERE topic_id = bt.topic_id AND IFNULL(deleted, 0) = 0) as optionCount,
        bt.enabled
        FROM biz_topics bt
        WHERE 1 = 1
        AND bt.questionnaire_id = #QuestionnaireId#
        AND IFNULL(bt.deleted, 0) = 0
        ORDER BY bt.sequence
    </entry>

    <entry key="sql.update.topic.deleted">
        UPDATE biz_topics
        SET deleted = 1
        WHERE 1 = 1
        AND topic_id = #TopicId#
    </entry>

    <!-- 查询题目列表 -->
    <entry key="sql.select.topics.options">
        <![CDATA[
        SELECT
        bo.content AS content,
        bt2.topic_id AS topicId,
        bt2.sequence AS topicSequence,
        bo.sequence AS optionSequence,
        bo.option_id AS optionId,
        bt2.title AS title
        FROM
        biz_options bo
        JOIN biz_topics bt2 ON bo.topic_id = bt2.topic_id
        WHERE
        bo.topic_id IN (
            SELECT
            bt.topic_id
            FROM
            biz_topics bt
            WHERE
            bt.questionnaire_id = #questionnaireId#
        )
          ]]>
    </entry>
</properties>
