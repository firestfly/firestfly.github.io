<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <comment>客服中心首页搜索功能</comment>

    <entry key="sql.query.customer.index.search.fuzzy">
        <![CDATA[
        	-- 模糊查询客户信息
        	SELECT DISTINCT * FROM
			(SELECT c.id,
			       c. CODE,
			       c.fullName AS NAME,
			       c.mainMobile AS extend1,
			       (SELECT h.NAME
			          FROM main_house h
			         WHERE 1 = 1
			           AND h.id = mch.houseId
			           AND IFNULL(h.isDeleted,0) = 0 limit 1) as extend2,
			       mch.houseId as extend3
			  FROM main_customer c
			  LEFT JOIN mid_customer_house mch ON c.id = mch.customerId AND IFNULL(mch.isDeleted,0) = 0
              LEFT JOIN main_house mh ON mch.houseId = mh.id AND IFNULL(mh.isDeleted,0) = 0
			 WHERE c.isdeleted = 0
			   AND c.$column$ LIKE CONCAT(CONCAT('%', #value#), '%') ESCAPE '/'
			   AND mh.projectId in (select organizationId from mid_organization_user where userId = #userId#  AND IFNULL(isDeleted,0) = 0)
			 ) T
			 LIMIT 10
	    ]]>
    </entry>

    <entry key="sql.query.customer.index.search.precise">
        <![CDATA[
        	-- 精确查询客户信息
			SELECT DISTINCT * FROM
			(SELECT c.id,
			       c. CODE,
			       c.fullName AS NAME,
			       c.mainMobile AS extend1,
			       (SELECT h.NAME
			          FROM main_house h
			         WHERE 1 = 1
			           AND h.id = mch.houseId
			           AND IFNULL(h.isDeleted,0) = 0 limit 1) as extend2,
			       mch.houseId as extend3
			  FROM main_customer c
			  LEFT JOIN mid_customer_house mch ON c.id = mch.customerId AND IFNULL(mch.isDeleted,0) = 0
              LEFT JOIN main_house mh ON mch.houseId = mh.id AND IFNULL(mh.isDeleted,0) = 0
			 WHERE c.isdeleted = 0
			   and c.$column$ = #value#
			   AND mh.projectId in (select organizationId from mid_organization_user where userId = #userId#  AND IFNULL(isDeleted,0) = 0)
			) T
			 LIMIT 10
	    ]]>
    </entry>

</properties>
