function validateIdcard(){if("1"!==$("[name='certificateType']").val())return{isError:!1};var a=$("[name='certificateId']").val().toUpperCase();if(""==a)return{isError:!1};var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},c="",d=!0;if(a&&/^[1-9][0-9]{5}(19[0-9]{2}|200[0-9]|2010)(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])[0-9]{3}[0-9xX]$/i.test(a))if(b[a.substr(0,2)]){if(18==a.length){a=a.split("");for(var e=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],f=[1,0,"X",9,8,7,6,5,4,3,2],g=0,h=0,i=0,j=0;17>j;j++)h=a[j],i=e[j],g+=h*i;f[g%11];f[g%11]!=a[17]&&(c="校验位错误",d=!1)}}else c="地址编码错误",d=!1;else c="身份证号格式错误",d=!1;return d||console.log(c),{isError:!d,errorInfo:c}}!function(){function a(){$("#Add_userBtn").click(function(){$(".c_form").show(),$(".c_search").hide()}),$(".btn.btn-success").hide()}function b(){Oa&&Oa.abort(),$("._basic_view").removeClass("on"),$(".c_hide").addClass("on"),Oa=Common.ajax({url:Na.url_editCustomer,type:"get",success:function(a){a.success&&(wa=a.details,j(a),p())},error:function(a){p()},complete:function(){}})}function c(){Pa&&Pa.abort(),$("._tags_view").removeClass("on"),$(".c_tags_hide").addClass("on"),Pa=Common.ajax({url:Na.url_tags,type:"get",success:function(a){if(a.success){tagIds=[];for(var b=a.details.length-1;b>=0;b--)tagIds.push(a.details[b].contentId);ua={tagIds:tagIds},g(a)}},error:function(a){},complete:function(){}})}function d(){Qa&&Qa.abort(),$("._details_view").removeClass("on"),$(".c_d_hide").addClass("on"),Qa=Common.ajax({url:Na.url_editDetailsCustomer,type:"get",success:function(a){a.success&&(xa=a.details,i(a)),r()},error:function(a){i(a),r()},complete:function(){}})}function e(){Ra&&Ra.abort(),Ra=Common.ajax({url:Na.url_dictionaryTags,type:"GET",success:function(a){a.success&&(va=a.details,h(a),q())},error:function(a){h(),q()},complete:function(){}})}function f(){Sa&&Sa.abort(),Sa=Common.ajax({url:Na.url_dictionary,type:"POST",data:{codes:"CustomerAffilication,CustomerSex,CustomerType,CustomerIdentity,CustomerHobbies,HouseCustomerRelationType,CustomerRelationType,CustomerOccupation,CustomerBlood,CustomerCertificateType#CRMv2"},success:function(a){a.success&&(k(a),b(),d(),c(),e())},error:function(a){b(),d(),c(),e()},complete:function(){}})}function g(a){var b=ta(a);$("#tags_edit_btn").show(),$("#tags_save_btn").hide(),$("#tags_cancel_btn").hide(),sa.html(b)}function h(a){var b=Fa(a);Ea.html(b),$("#tags_edit_btn").show(),q()}function i(a){var b=S({customerDetails:a.details}),c=U({customerDetails:a.details}),d=W({customerDetails:a.details}),e=Y({customerDetails:a.details}),f=_({customerDetails:a.details}),g=ba({customerDetails:a.details}),h=da({customerDetails:a.details}),i=fa({customerDetails:a.details}),j=temp_details_J_tel({customerDetails:a.details}),k=ha({customerDetails:a.details}),l=ja({customerDetails:a.details}),m=na({customerDetails:a.details}),n=pa({customerDetails:a.details}),o=la({customerDetails:a.details}),p=ra({customerDetails:a.details});R.html(b),T.html(c),V.html(d),X.html(e),Z.html(f),aa.html(g),ca.html(h),ea.html(i),jq_details_J_tel.html(j),ga.html(k),ia.html(l),ma.html(m),oa.html(n),ka.html(o),qa.html(p),$("#details_edit_btn").show()}function j(a){var b=y({customer:a.details}),c=A({customer:a.details}),d=I({customer:a.details}),e=K({customer:a.details}),f=M({customer:a.details}),g=O({customer:a.details}),h=Q({customer:a.details}),i=C({customer:a.details}),j=E({customer:a.details}),k=G({customer:a.details});x.html(b),z.html(c),B.html(i),H.html(d),J.html(e),L.html(f),N.html(g),P.html(h),D.html(j),F.html(k),$("#basic_edit_btn").show()}function k(a){var b=Ba(a),c=Da(a),d=Ha(a),e=Ja(a),f=La(a),g=za(a);Aa.html(b),Ca.html(c),Ga.html(d),Ia.html(e),Ka.html(f),ya.html(g)}function l(){ya=$("#_d_cardType"),Aa=$("#_d_customerType"),Ca=$("#_d_affiliation"),Ga=$("#_d_sex"),Ia=$("#_d_job"),Ka=$("#_d_bloodType"),za=template.compile($(Na.d_cardTypeTempId).html()),Ba=template.compile($(Na.d_customerTypeTempId).html()),Da=template.compile($(Na.d_affiliationTempId).html()),Ha=template.compile($(Na.d_sexTempId).html()),Ja=template.compile($(Na.d_jobTempId).html()),La=template.compile($(Na.d_bloodType).html())}function m(){Ea=$("#_d_tags"),Fa=template.compile($(Na.d_tagsTempId).html())}function n(){sa=$("#_view_tags"),ta=template.compile($(Na.tagsTempId).html())}function o(){x=$("#_view_name"),z=$("#_view_cardType"),B=$("#_view_sex"),D=$("#_view_customerType"),F=$("#_view_affType"),H=$("#_view_idcard"),J=$("#_view_mainMobile"),L=$("#_view_standbyMobile"),N=$("#_view_officeTel"),P=$("#_view_homeTel"),R=$("#_view_postCode"),T=$("#_view_email"),V=$("#_view_qq"),X=$("#_view_wechat"),Z=$("#_view_birthday"),aa=$("#_view_blood"),ca=$("#_view_J_name"),ea=$("#_view_J_phone"),jq_details_J_tel=$("#_view_J_tel"),ga=$("#_view_c_addre"),ia=$("#_view_h_addre"),ma=$("#_view_c"),oa=$("#_view_job"),ka=$("#_view_conAddre"),qa=$("#_view_remark"),y=template.compile($(Na.nameTempId).html()),A=template.compile($(Na.cardTypeTempId).html()),C=template.compile($(Na.sexTempId).html()),E=template.compile($(Na.customerTypeTempId).html()),G=template.compile($(Na.affTypeTempId).html()),I=template.compile($(Na.idcardTempId).html()),K=template.compile($(Na.mainMobileTempId).html()),M=template.compile($(Na.standbyMobileTempId).html()),O=template.compile($(Na.officeTelTempId).html()),Q=template.compile($(Na.homeTelTempId).html()),S=template.compile($(Na.postCodeTempId).html()),U=template.compile($(Na.emailTempId).html()),W=template.compile($(Na.qqTempId).html()),Y=template.compile($(Na.wechatTempId).html()),_=template.compile($(Na.birthdayTempId).html()),ba=template.compile($(Na.bloodTempId).html()),da=template.compile($(Na.J_nameTempId).html()),fa=template.compile($(Na.J_phoneTempId).html()),temp_details_J_tel=template.compile($(Na.J_telTempId).html()),ha=template.compile($(Na.c_addreTempId).html()),ja=template.compile($(Na.h_addreTempId).html()),na=template.compile($(Na.c_TempId).html()),pa=template.compile($(Na.job_TempId).html()),la=template.compile($(Na.conAdree_TempId).html()),ra=template.compile($(Na.remark_TempId).html())}function p(){var a=$("#basic_edit_btn"),b=$("#basic_cancel_btn");$("#basic_save_btn").hide(),$("#basic_cancel_btn").hide(),a.unbind("click"),a.click(function(){$("#basic_save_btn").show(),$("#basic_cancel_btn").show(),$("#basic_edit_btn").hide(),$("._basic_view").addClass("on"),$(".c_hide").removeClass("on"),Common.setFormData(basic_info,wa),s()}),b.unbind("click"),b.click(function(){$("#basic_save_btn").hide(),$("#basic_cancel_btn").hide(),$("#basic_edit_btn").show(),$("._basic_view").removeClass("on"),$(".c_hide").addClass("on"),$("#basic_info").find(".errortip").removeClass("on").tooltip("destroy")})}function q(){var a=$("#tags_edit_btn"),b=$("#tags_cancel_btn");$("#tags_save_btn").hide(),$("#tags_cancel_btn").hide(),a.unbind("click"),a.click(function(){$("#tags_save_btn").show(),$("#tags_cancel_btn").show(),$("#tags_edit_btn").hide(),$("._tags_view").addClass("on"),$(".c_tags_hide").removeClass("on"),Common.setFormData(edit_person_tips,ua),t()}),b.unbind("click"),b.click(function(){$("#tags_save_btn").hide(),$("#tags_cancel_btn").hide(),$("#tags_edit_btn").show(),$("._tags_view").removeClass("on"),$(".c_tags_hide").addClass("on")})}function r(){var a=$("#details_edit_btn"),b=$("#details_cancel_btn");$("#details_save_btn").hide(),$("#details_cancel_btn").hide(),a.unbind("click"),a.click(function(){$("#details_save_btn").show(),$("#details_cancel_btn").show(),$("#details_edit_btn").hide(),$("._details_view").addClass("on"),$(".c_d_hide").removeClass("on"),Common.setFormData(detail_info,xa||!1),u()}),b.unbind("click"),b.click(function(){$("#details_save_btn").hide(),$("#details_cancel_btn").hide(),$("#details_edit_btn").show(),$("._details_view").removeClass("on"),$(".c_d_hide").addClass("on"),$("#detail_info").find(".errortip").removeClass("on").tooltip("destroy")})}function s(){$("#basic_save_btn").unbind("click"),$("#basic_save_btn").click(function(){$("#basic_info").find(".errortip").removeClass("on").tooltip("destroy");var a=validate($("#basic_info")[0],{validateAll:!0,onerror:function(a,b){$(a).closest("td").find(".errortip").addClass("on").tooltip({title:b,placement:"bottom"})}});if(a)return void Common.tip.add({text:"保存失败,请检查是否填写正确",type:"warning"});var c=Common.getFormData($("#basic_info")[0]);Ta&&Ta.abort(),Ta=Common.ajax({url:Na.url_update_basic,type:"post",data:c,success:function(a){a.success?(Common.tip.add({text:"保存成功",type:"info"}),b(),customerInfoInit()):Common.tip.add({text:"保存失败",type:"warning"})},error:function(a){"403"==a.code&&alert(a.message),Common.tip.add({text:"保存失败",type:"warning"})},complete:function(){}})})}function t(){$("#tags_save_btn").unbind("click"),$("#tags_save_btn").click(function(){var a=Common.getFormData(edit_person_tips);Ua&&Ua.abort(),Ua=Common.ajax({url:Na.url_update_tags,type:"post",data:a,success:function(a){a.success?(Common.tip.add({text:"保存成功",type:"info"}),c(),customerInfoInit()):Common.tip.add({text:"保存失败",type:"warning"})},error:function(a){Common.tip.add({text:"保存失败",type:"warning"})},complete:function(){}})})}function u(){$("#details_save_btn").unbind("click"),$("#details_save_btn").click(function(){$("#detail_info").find(".errortip").removeClass("on").tooltip("destroy");var a=validate($("#detail_info")[0],{validateAll:!0,onerror:function(a,b){$(a).closest("td").find(".errortip").addClass("on").tooltip({title:b,placement:"bottom"})}});if(a)return void Common.tip.add({text:"保存失败,请检查是否填写正确",type:"warning"});var b=Common.getFormData($("#detail_info")[0]);Va&&Va.abort(),Va=Common.ajax({url:Na.url_update_details,type:"post",data:b,success:function(a){a.success?(Common.tip.add({text:"保存成功",type:"info"}),d(),customerInfoInit()):Common.tip.add({text:"保存失败",type:"warning"})},error:function(a){Common.tip.add({text:"保存失败",type:"warning"})},complete:function(){}})})}function v(){a(),f()}function w(a){Ma||(Ma=!0,o(),n(),l(),m()),v(a)}var x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=null,R=null,S=null,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=null,ga=null,ha=null,ia=null,ja=null,ka=null,la=null,ma=null,na=null,oa=null,pa=null,qa=null,ra=null,sa=null,ta=null,ua=null,va=null,wa=null,xa=null,ya=null,za=null,Aa=null,Ba=null,Ca=null,Da=null,Ea=null,Fa=null,Ga=null,Ha=null,Ia=null,Ja=null,Ka=null,La=null,Ma=!1,Na={url_editCustomer:servicePath.customer+"/v1/customer/"+window.customerId+"/basic",url_editDetailsCustomer:servicePath.customer+"/v1/customer/"+window.customerId+"/details",url_dictionary:servicePath.customer+"/v1/dict/items",url_dictionaryTags:servicePath.customer+"/v1/batch/dict/CustomerTags/items",url_tags:servicePath.customer+"/v1/customer/"+window.customerId+"/tags",url_update_basic:servicePath.customer+"/v1/customer/updateBasic",url_update_details:servicePath.customer+"/v1/customer/updateDetails",url_update_tags:servicePath.customer+"/v1/customer/"+window.customerId+"/updateTags",nameTempId:"#__view_name",cardTypeTempId:"#__view_cardType",customerTypeTempId:"#__view_customerType",idcardTempId:"#__view_idcard",mainMobileTempId:"#__view_mainMobile",standbyMobileTempId:"#__view_standbyMobile",officeTelTempId:"#__view_officeTel",homeTelTempId:"#__view_homeTel",postCodeTempId:"#__view_postCode",emailTempId:"#__view_email",qqTempId:"#__view_qq",wechatTempId:"#__view_wechat",birthdayTempId:"#__view_birthday",bloodTempId:"#__view_blood",J_nameTempId:"#__view_J_name",J_phoneTempId:"#__view_J_phone",J_telTempId:"#__view_J_tel",c_addreTempId:"#__view_c_addre",h_addreTempId:"#__view_h_addre",c_TempId:"#__view_c",job_TempId:"#__view_job",conAdree_TempId:"#__view_conAddre",remark_TempId:"#__view_remark",tagsTempId:"#__view_tags",sexTempId:"#__view_sex",affTypeTempId:"#__view_affType",d_cardTypeTempId:"#__d_cardType",d_customerTypeTempId:"#__d_customerType",d_affiliationTempId:"#__d_affiliation",d_sexTempId:"#__d_sex",d_jobTempId:"#__d_job",d_bloodType:"#__d_bloodType",d_tagsTempId:"#__d_tags"},Oa=null,Pa=null,Qa=null,Ra=null,Sa=null,Ta=null,Ua=null,Va=null;w()}();