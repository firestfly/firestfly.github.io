function validateIdcard(){if("1"!==$("[name='basic.certificateType']").val())return{isError:!1};var a=$("[name='basic.certificateId']").val().toUpperCase();if(""==a)return{isError:!1};var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},c="",d=!0;if(a&&/^[1-9][0-9]{5}(19[0-9]{2}|200[0-9]|2010)(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])[0-9]{3}[0-9xX]$/i.test(a))if(b[a.substr(0,2)]){if(18==a.length){a=a.split("");for(var e=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],f=[1,0,"X",9,8,7,6,5,4,3,2],g=0,h=0,i=0,j=0;17>j;j++)h=a[j],i=e[j],g+=h*i;f[g%11];f[g%11]!=a[17]&&(c="校验位错误",d=!1)}}else c="地址编码错误",d=!1;else c="身份证号格式错误",d=!1;return d||console.log(c),{isError:!d,errorInfo:c}}window.Page_houseinfo={config:{tagObj:{1:{color:"tag-yellow",name:"拥有",relationType:"1"},2:{color:"tag-blue",name:"居住",relationType:"2"},4:{color:"tag-cyan",name:"账单",relationType:"4"},5:{color:"tag-green",name:"分润",relationType:"5"},98:{color:"tag-red",name:"其他",relationType:"98"},3:{color:"tag-orange",name:"租赁",relationType:"3"}}}},window.Page_houseinfo.info=function(){function a(a){m&&m.abort(),m=Common.ajax({url:l.url.getHouseStatus,type:"POST",data:a,success:function(a){a.success&&(l.tmpl.status.container.html(template(l.tmpl.status.id,a.details)),l.tmpl.broadband.container.html(template(l.tmpl.broadband.id,a.details)))},error:function(){},complete:function(){}})}function b(a){n&&n.abort(),n=Common.ajax({url:l.url.getHouse,type:"get",data:a,success:function(a){a.success&&c(a.details)},error:function(){},complete:function(){}})}function c(a){l.tmpl.info.container.html(template(l.tmpl.info.id,a)),l.tmpl.address.container.html(template(l.tmpl.address.id,a)),window.houseName=a.basic&&a.basic.name,k.data=a,a.basic.combine||(document.getElementById("btn_houseMegerList").style.display="none",document.getElementById("btn_mergeHouseRestore").style.display="none")}function d(){}function e(){$("#btnDetailMore").on("click",function(){$("#infoContainer").find("div[data-detail]").toggleClass("panel-hide"),$("#infoPanel").toggleClass("panel-visable")})}function f(c){h=window.houseId,b({houseId:h}),a($.param({codes:j},!0))}function g(a){i||(i=!0,d(),e()),f(a)}var h="",i=!1,j=["Broadband","HouseStatus"],k={data:null},l={url:{getHouse:servicePath.house+"/v1/house/full",getHouseStatus:servicePath.customer+"/v1/dict/items"},tmpl:{info:{id:"tmplHouseInfo",container:$("#infoContainer")},address:{id:"tmplHouseTitle",container:$("#houseTitle")},status:{id:"tmplStatus",container:$("#houseStatusTemp")},broadband:{id:"tmplBoardband",container:$("#houseBroadbandTemp")}}},m=null,n=null;return{init:g,houseInfo:k}}(),window.Page_houseinfo.houseSplit=function(){function a(a){s&&s.abort(),s=Common.ajax({url:r.url_getSubHouse,type:"get",data:a,success:function(a){a.success&&e(a)},error:function(){},complete:function(){}})}function b(b){t&&t.abort(),t=Common.ajax({url:r.url_houseSplit.replace("{:houseId}",b.houseId),type:"POST",data:b,success:function(b){b.success?($("#subHouseName").val(""),$("#subHousecheckinTime").val(""),$("#subHouseArea").val(""),alert("拆分房屋成功。"),a({houseId:p})):alert(b.message),m.show()}})}function c(b){u&&u.abort(),u=Common.ajax({url:r.url_deleteSubHouse.replace("{:subHouseId}",b.subhouseId),type:"get",data:b,success:function(b){b.success&&(alert("删除成功!!"),a({houseId:p}))}})}function d(a){v&&v.abort(),v=Common.ajax({url:r.url_getSubHouseInfo,type:"get",data:a,success:function(a){a.success}})}function e(a){var b=k(a);j.html(b)}function f(){l=$("#modal_houseSplit"),m=$("#houseSplit_ok"),n=$("#houseMeger_ok"),o=$("#houseSplit_cancel"),j=$("#subHouseTable"),k=template.compile($(r.tempid_subHouse).html())}function g(){m.on("click",function(){m.hide();var a=$("#subHouseName").val(),c=$("#subHousecheckinTime").val(),d=$("#subHouseArea").val();return""==d||null==d.match(/^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[0-9][0-9]*))$/)?(alert("房屋面积必须填写，且必须为数字。"),void m.show()):(a=a.replace(/^\s+|\s+$/g,""),void(""==a?(alert("房屋名称不能为空!"),m.show()):""==c?(alert("入住日期不能为空!"),m.show()):b({houseId:p,houseName:a,checkInTime:c,area:d})))}),n.on("click",function(){if(n.hide(),$('input[name="zfxk"]:checked').length<2)return alert("请选择要合并的房屋，房屋必须大于一个。"),void n.show();var b=[],c=0;$('input[name="zfxk"]:checked').each(function(){b[c]=$(this).val(),c++});var d=r.url_houseMeger.replace("{:houseId}",b+"");confirm("你确定要合并选中的房屋吗？")&&Common.ajax({url:d,type:"get",data:{houseIds:b},success:function(b){b.success?(alert("操作成功!"),a({houseId:p})):alert(b.message),n.show()}})}),j.on("click",".j_del",function(){var a=$(this);window.confirm("确定删除子房屋？")&&c({subhouseId:a.attr("data-id")})}),j.on("click",".j_edit",function(){var a=$(this);d({houseId:a.attr("data-id")})}),o.on("click",function(){l.modal("hide")})}function h(b){l.modal(),p=b.houseId,a({houseId:p})}function i(a){q||(q=!0,f(),g()),h(a)}var j,k,l,m,n,o,p="",q=!1,r={url_getSubHouse:servicePath.house+"/v1/house/subhouse",url_houseSplit:servicePath.house+"/v1/house/{:houseId}/split",url_houseMeger:servicePath.house+"/v1/subHouse/{:houseId}/merge",url_deleteSubHouse:servicePath.house+"/v1/subHouse/{:subHouseId}/del",url_getSubHouseInfo:servicePath.house+"/v1/house/detail",tempid_subHouse:"#subHouseTemp"},s=null,t=null,u=null,v=null;return{init:i}}(),window.Page_houseinfo.houseStatus=function(){function a(a){j&&j.abort(),a.id=window.houseId,a.isSecondhand=a.secondhand,j=Common.ajax({url:i.url_updateHouseStatus,type:"post",data:a,success:function(a){a.success?(alert("操作成功."),jq_dialog.modal("hide"),window.location.reload()):alert("操作失败.")},error:function(){alert("操作失败.")}})}function b(){jq_dialog_ok.on("click",function(){var b=Common.getFormData($("#modal_houseStatus_form").get(0));a(b)}),jq_dialog_cancel.on("click",function(){jq_dialog.modal("hide"),window.location.reload()})}function c(){f=$("#houseStatueList"),jq_dialog=$("#modal_houseStatus"),jq_dialog_ok=$("#houseStatus_ok"),jq_dialog_cancel=$("#houseStatus_cancel"),dom_form=$("#modal_houseStatus_form").get(0),subHouse_infoBody=$("#subHouseTable"),temp_subHouse=template.compile($(i.tempid_subHouse).html())}function d(a){jq_dialog.modal();var b=a.data.data.basic.broadband,c={contactsId:a.data.data.basic.contactsId,secondhand:a.data.data.basic.secondhand,broadband:a.data.data.basic.broadband,status:a.data.data.basic.status,deliverTime:a.data.data.basic.deliverTime,checkInTime:a.data.data.basic.checkInTime};$("#broadband"+b).attr("checked",!0),Common.setFormData(dom_form,c),g=window.houseId}function e(a){h||(h=!0,c(),b()),d(a)}var f,g="",h=!1,i={url_getRelation:servicePath.customer+"/v1/customer/houseCheckin",url_updateHouseStatus:servicePath.house+"/v1/house/checkinStatus",tempid_relation:"#transferHouseTemp",tempid_subHouse:"#subHouseTemp"},j=null;return{init:e}}(),window.Page_houseinfo.historyinfo=function(){function a(a){n&&n.abort(),n=Common.ajax({url:l.url_getHistory,type:"get",data:a,success:function(a){a.success&&c(a)},error:function(){},complete:function(){}})}function b(){h.on("click",function(){return g.removeClass("active"),!1})}function c(a){var b=k(a);i.html(b)}function d(a){g=$("#ownerHistory_bar"),i=$("#ownerHistory_list"),h=$("#ownerHistory_close"),k=template.compile($(l.tempid_history).html())}function e(a){j=window.houseId,g.addClass("active")}function f(c){m||(d(),b()),e(c),a({houseId:j})}var g,h,i,j,k,l={url_getHistory:servicePath.customer+"/v1/customer/house/history",tempid_history:"#ownerHistoryTemp"},m=!1,n=null;return{init:f}}(),window.house.TakeRelationStatus=function(){function a(a){r&&r.abort(),r=Common.ajax({url:q.url_getPropertyServiceStatus,type:"get",data:a,success:function(a){if(a.success){var b,c=a.details.list,d=c.length,e=a.details.pagination,f=$("#dtn-PropertyService");if(0!=c.length){for(var g=0;d>g;g++){var h=c[g];if(""==h.timeline)h.statusTo="进行中";else for(j in h.timeline){if("1010"==h.timeline[j].status||"1009"==h.timeline[j].status){h.statusTo="已完成";break}h.statusTo="进行中"}}b=template("PropertyServiceTemplate",a.details),f.html(b),y.render({curpage:e.curPage,pagesize:e.pageSize,totalpage:e.totalPage,totalsize:e.totalSize})}else f.html(m)}},error:function(){},complete:function(){}}),Common.loading({text:"",container:"#dtn-TakeRelationBar",handle:r})}function b(a){u&&u.abort(),u=Common.ajax({url:q.url_getParcelStatus,type:"get",data:a,success:function(a){if(a.success){var b,c=a.details,d=$("#dtn-Parcel"),e=a.details.pagination;if(null!=c.list){for(var f=0;f<c.list.length;f++){var g=c.list[f],h=c.list[f].status;switch(h){case"0":g.statusTo="代收登记";break;case"1":g.statusTo="代收确认";break;case"2":g.statusTo="业主签收";break;case"3":g.statusTo="业主拒收";break;case"4":g.statusTo="退回快递公司";break;case"5":g.statusTo="代发登记";break;case"6":g.statusTo="代发确认";break;case"7":g.statusTo="快递公司取走";break;case"8":g.statusTo="快递公司拒收";break;case"9":g.statusTo="业主取回"}}b=template("ParcelTemplate",c),d.html(b),y.render({curpage:e.curPage,pagesize:e.pageSize,totalpage:e.totalPage,totalsize:e.totalSize})}else d.html(m)}},error:function(){},complete:function(){}}),Common.loading({text:"",container:"#dtn-TakeRelationBar",handle:u})}function c(a){null!=v&&v.abort(),v=Common.ajax({url:q.url_getTaskPercent.replace("{:houseCode}",window.houseCode),type:"get",data:a,success:function(a){if(a.success){var b=a.details.join(" / ");$("#taskPercent").html('<span class="icf-renwu co-deepCyan"></span> 任务 '+b)}},error:function(a){$("#taskPercent").html('<span class="icf-renwu co-deepCyan"></span> 任务 0 / 0')},complete:function(){}})}function d(a){null!=s&&s.abort(),s=Common.ajax({url:q.url_getPropertyFee,type:"get",data:a,success:function(a){if(a.success){var b=a.details,c=$("#dtn-PropertyFee");if(b&&b.bis.length>0){var d=template("PropertyFeeTemplate",b);c.html(d)}else c.html(m)}},error:function(a){var b=$("dtn-PropertyFee");b.html(m)},complete:function(){}}),Common.loading({text:"",container:"#dtn-TakeRelationBar",handle:s})}function e(a){null!=t&&t.abort(),t=Common.ajax({url:q.url_getPropertyFeeIsPaid+"?houseId="+window.houseId,type:"get",data:a,success:function(a){if(a.success){var b=a.details?"已缴":"未缴";$("#propertyFeeIsPaid").html('<span class="icf-wuyefei co-green"></span> 物业费 '+b)}},error:function(a){$("#propertyFeeIsPaid").html('<span class="icf-wuyefei co-green"></span> 物业费 未知')},complete:function(){}})}function f(c){$("#propertyFeeIsPaid").bind("click",function(){$("#TakeRelationBox").find(".active").removeClass("active"),$("#dtn-PropertyFee").addClass("active"),$("#dtn-TakeRelationBar").find(".active").removeClass("active"),$('#TakeRelationBox > a[order="1"]').addClass("active"),$(".dtn-tabbar").eq(1).addClass("active"),$("#TakeRelationPagination").html(""),d({houseId:k,curPage:1,pageSize:10})}),$("#taskPercent").bind("click",function(){$("#TakeRelationBox").find(".active").removeClass("active"),$("#dtn-PropertyService").addClass("active"),$("#dtn-TakeRelationBar").find(".active").removeClass("active"),$('#TakeRelationBox > a[order="0"]').addClass("active"),$(".dtn-tabbar").eq(0).addClass("active"),$("#TakeRelationPagination").html(""),a({houseCode:l,curPage:1,pageSize:10})}),$("#TakeRelationBox>a").click(function(){var c=$(this).attr("order"),e=$(".dtn-tabbar").eq(c).attr("id");$("#TakeRelationBox").find(".active").removeClass("active"),$(this).addClass("active"),$("#dtn-TakeRelationBar").find(".active").removeClass("active"),$(".dtn-tabbar").eq(c).addClass("active"),$("#TakeRelationPagination").html(""),"dtn-PropertyService"==e?a({houseCode:l,curPage:1,pageSize:10}):"dtn-Parcel"==e?b({houseId:k,curPage:1,pageSize:10}):"dtn-PropertyFee"==e&&d({houseId:k})})}function g(a){}function h(a){k=window.houseId,l=window.houseCode}function i(b){p||(p=!0,g(),f()),h(b),a({houseCode:l,curPage:n,pageSize:o}),c({}),e({})}var k,l,m="<div class='dtn-noHasData'>暂无数据</div>",n=1,o=10,p=!1,q={url_getPropertyServiceStatus:servicePath.task+"/v1/callcenter/task/app/list",url_getPropertyFee:servicePath.house+"/v1/subscription/propertyFee",url_getPropertyFeeIsPaid:servicePath.house+"/v1/subscription/propertyFee/isPaid",url_getParcelStatus:servicePath.house+"/v1/subscription/parcel",url_getTaskPercent:servicePath.task+"/v1/callcenter/task/getTaskPercent/{:houseCode}",tempid_TakeRelation:"#PropertyServiceTemplate",tempid_Parcel:"#ParcelTemplate",tempid_PropertyStatus:"#PropertyFeeTemplate"},r=null,s=null,t=null,u=null,v=null,w={getPropertyServiceStatusPage:function(b,c){a({houseCode:l,curPage:b,pageSize:c})},getParcelStatusPage:function(a,c){b({houseId:k,curPage:a,pageSize:c})}},x="getPropertyServiceStatusPage",y=new Pagination({template:"#paginationtmpl",selector:"#TakeRelationPagination",onchange:function(a){n=a.curpage,o=a.pagesize,w[x](n,o)}});return i(),{init:i}}(),window.Page_houseinfo.transferHouse=function(){function a(){Common.ajax({url:W.url_ajax_dictionary,type:"POST",data:{codes:"CustomerAffilication,CustomerCertificateType#CRMv2,CustomerSex,CustomerType,CustomerIdentity,CustomerHobbies,HouseCustomerRelationType,CustomerRelationType,CustomerOccupation,CustomerBlood"},success:function(a){a.success&&d(a)},error:function(a){},complete:function(){}})}function b(a){a.houseId=window.houseId,X&&X.abort(),X=Common.ajax({url:W.url_seacth_list,type:"get",data:a,success:function(a){a.success&&c(a)},error:function(a){},complete:function(){}}),Common.loading({text:"",container:"#customerTableDiv",handle:X})}function c(a){var b=y(a.details.customers);x.html(b);var c=a.details.customers.pagination;Z.render({curpage:c.curPage,pagesize:c.pageSize,totalpage:c.totalPage,totalsize:c.totalSize}),Z.pagesize=c.pageSize}function d(a){var b=F(a),c=H(a),d=J(a),e=L(a),f=N(a),g=P(a);E.html(b),G.html(c),I.html(d),K.html(e),M.html(f),O.html(g),n()}function e(){E=$("#_d_cardType"),G=$("#_d_customerType"),I=$("#_d_affiliation"),K=$("#_d_sex"),M=$("#_d_job"),O=$("#_d_bloodType"),Q=$("#_d_hobby"),R=$("#_d_sp"),S=$("#_d_houseRel"),F=template.compile($(W.d_cardTypeTempId).html()),H=template.compile($(W.d_customerTypeTempId).html()),J=template.compile($(W.d_affiliationTempId).html()),L=template.compile($(W.d_sexTempId).html()),N=template.compile($(W.d_jobTempId).html()),P=template.compile($(W.d_bloodType).html()),a()}function f(){$("#addc_form_btn").hide();var a=Common.getFormData($("#form_Customer")[0]),b=Common.getFormData($("#form_CustomerDetail")[0]),c=$.extend({},a,b);Common.ajax({url:W.url_addCustomer,type:"post",data:c,success:function(a){a.success?(alert("新增客户成功."),h(a.details,$("#J_form__username").val()),g()):alert(a.message),$("#addc_form_btn").show()},error:function(a){alert("保存失败："+a.message),$("#addc_form_btn").show()},complete:function(){}})}function g(){$("#form_Customer")[0].reset(),$("#form_CustomerDetail")[0].reset()}function h(a,b){var c={customerId:a,customerName:b};if(0==$("#customer_ID_"+a).length){var d=A({customer:c});jq_relationNewList.append(d)}}function i(a){V&&V.abort(),j(),V=Common.ajax({url:W.url_getRelation,type:"get",data:a,success:function(a){if(a.success){for(var b=[],c=[],d=null,e=a.details.length,f=0;e>f;f++){var g=a.details[f];"1"==g.relationType?(b.push(g.fullName),C.push(g.customerId),D.push(g.relationType)):(d=Page_houseinfo.config.tagObj[g.relationType],d&&(g.color=d.color,g.spanName=d.name,c.push(g)))}j(b.join("，"),c)}},error:function(a){},complete:function(){}})}function j(a,b){t.text(a||"");var c=b?z({list:b}):"";r.html(c)}function k(a){var b=$("[name=transferHouseNewCustomer]"),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c[d]=b[d].value;a.ownerIds=c.join(","),Y&&Y.abort(),Y=Common.ajax({url:W.url_removeRelation,type:"post",data:a,success:function(a){window.location.reload()},error:function(a){alert(a.message)},complete:function(){}})}function l(){u.on("click",function(){var a=r.find("input:checked"),b=$("#transferRelationNewList").children(),c=b.length;if(0>=c)return void alert("请先添加新业主,再进行过户操作.");if(window.confirm("确定将房屋过户？")){var d=[],e=[];a.each(function(a,b){var c=$(b);d.push(c.attr("data-id")),e.push(c.attr("data-type"))}),k({houseId:B,customerIds:d.concat(C).join(","),relationTypes:e.concat(D).join(",")})}}),v.on("click",function(){q.modal("hide"),window.location.reload()}),w.on("click",function(){q.modal("hide"),window.location.reload()}),$("#List_searchBtn").bind("click",function(){var a="";if($("#List_searchForm").find("input").each(function(){a+=$(this).val()}),""==a)alert("查询内容不能为空");else{T=1,U=10,W.url_seacth_list=servicePath.customer+"/v1/customer/queryCustomer4Search/"+T+"/"+U;var c=Common.getFormData(List_searchForm);c.houseId=window.houseId,b(c)}}),$("#Add_userBtn").bind("click",function(){$("#transferHouseList").slideUp(),$("#transferHouseForm").slideDown()}),$("#transfer_back_to_list").bind("click",function(){$("#transferHouseList").slideDown(),$("#transferHouseForm").slideUp()}),$("#addc_form_btn").bind("click",function(){var a=validate($("#form_Customer")[0],{validateAll:!0,onerror:function(a,b){$(a).closest("div").find(".errortip").addClass("on").tooltip({title:b,placement:"bottom"})}}),b=validate($("#form_CustomerDetail")[0],{validateAll:!0,onerror:function(a,b){$(a).closest("div").find(".errortip").addClass("on").tooltip({title:b,placement:"bottom"})}});a||b||f()}),x.on("click","a",function(){var a=$(this).attr("data-id"),b=$(this).attr("data-name");h(a,b)}),$("#transferRelationNewList").on("click","[name=transferHouseRemoveCustomer]",function(a){var b=$(this).attr("data-id");$("#"+b).remove()})}function m(){x=$("#List_listBody"),q=$("#modal_transferHouse"),r=$("#transferRelationList"),jq_relationNewList=$("#transferRelationNewList"),s=$("#transferAddress"),t=$("#transferOwnerName"),u=$("#transferHouse_ok"),v=$("#transferHouse_cancel"),w=$("#transferCloseBtn"),jq_dialog__addCustomer=$("#transferHouse_addCustomer"),z=template.compile($(W.tempid_relation).html()),A=template.compile($(W.tempid_relation_new).html()),y=template.compile($(W.searchTempId).html())}function n(){var a=$(".addc_specialidentity").find("input");a.each(function(){"8"==$(this).val()&&$(this).click(function(){$(".jiufen").toggleClass("on"),$("._begintime").attr("name","beginDate"),$("._staytime").attr("name","duration")})})}function o(a){C=[],D=[],q.modal(),s.text(a.houseName),B=window.houseId,i({houseId:B})}function p(a){e(),m(),l(),o(a)}var q,r,s,t,u,v,w,x,y,z,A,B="",C=[],D=[],E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=null,R=null,S=null,T=1,U=10,V=null,W={url_getRelation:servicePath.customer+"/v1/house/"+window.houseId+"/customers",url_removeRelation:servicePath.customer+"/v1/customer/houseRelation/houseTransfer",tempid_relation:"#transferHouseTemp",url_removeRelation_new:servicePath.customer+"/v1/customer/houseRelation/bind",url_seacth_list:servicePath.customer+"/v1/customer/queryCustomer4Search/"+T+"/"+U,url_addCustomer:servicePath.customer+"/v1/customer?houseId="+window.houseId,url_ajax_dictionary:servicePath.customer+"/v1/dict/items",tempid_relation_new:"#transferHouseNewTemp",searchTempId:"#__view_search_list",d_cardTypeTempId:"#__d_cardType",d_customerTypeTempId:"#__d_customerType",d_affiliationTempId:"#__d_affiliation",d_sexTempId:"#__d_sex",d_jobTempId:"#__d_job",d_bloodType:"#__d_bloodType",d_hobby:"#__d_hobby",d_sp:"#__d_sp",d_houseRelTempId:"#__d_houseRel"},X=null,Y=null,Z=new Pagination({template:"#paginationtmpl",selector:"#pagination",onchange:function(a){T=a.curpage,U=a.pagesize,W.url_seacth_list=servicePath.customer+"/v1/customer/queryCustomer4Search/"+T+"/"+U;var c=Common.getFormData(List_searchForm);c.houseId=window.houseId,b(c)}});return{init:p}}(),window.Page_houseinfo.relationinfo=function(){function a(a){w&&w.abort(),w=Common.ajax({url:v.url_getRelation.replace("{:id}",a.houseId),type:"get",success:function(a){a.success&&(window.currentCustomersOfHouse=a.details,h(a))},error:function(){},complete:function(){}}),Common.loading({text:"",container:".ly-right",handle:w})}function b(a,b){Common.ajax({url:v.url_removeRelation,type:"post",data:a,success:function(a){a.success&&b.remove()},error:function(){},complete:function(){}})}function c(){Common.ajax({url:servicePath.customer+"/v1/batch/dict/HouseCustomerRelationType/items",type:"get",success:function(a){if(a.success){if(!l)return;for(var b=0;b<l.length;b++)$(".owner-tagbox").eq(b).html(template("RelationBarTemp",a));for(var c=l.length-1;c>=0;c--)for(var d=l[c],e=d.customerId,f='div[data-id="'+e+'"] .owner-tagbox > span.tag.',g=d.relation,b=0;b<g.length;b++){var h=f+g[b].color+".tag-off";$(h).removeClass("tag-off")}}},error:function(){},complete:function(){}})}function d(a,b){Common.ajax({url:servicePath.customer+"/v1/customer/houseRelation/bind",type:"post",data:a,success:function(a){a.success?(alert("新增房屋关系成功！"),b.removeClass("tag-off")):alert(a.message)},error:function(a){a.message?alert(a.message):alert("新增房屋关系失败！")},complete:function(){}})}function e(a,b){Common.ajax({url:servicePath.customer+"/v1/customer/houseRelation/unbindByType",type:"post",data:a,success:function(a){a.success&&(alert("删除房屋关系成功！"),b.addClass("tag-off"))},error:function(){alert("删除房屋关系失败！")},complete:function(){}})}function f(a){if(a){var b=path.server+"/page/customer/"+a+"/details"+(window.houseId?"?houseId="+window.houseId:"");window.location.href=b}}function g(){hasEditRelationRole&&p.on("click",".tag",function(){var a=$(this),b=a.attr("data-code"),c=a.parent().attr("data-id");return 0==a.index()?!1:(a.hasClass("tag-off")?d({houseId:window.houseId,customerId:c,relationType:b},a):e({houseId:window.houseId,customerId:c,relationType:b},a),!1)}),p.on("click",".bi-owner-info",function(){var a=$(this),b=a,c=b.attr("data-id");u[c];f(c)}),o.on("click",".relation-img",function(){var a=$(this),b=a,c=b.attr("data-id");u[c];f(c)}),o.on("click",".relation-del",function(){for(var a=$(this),c=a,d=c.attr("data-id"),e=u[d],f=e.customerId,g=e.relation,h=[],i=0;i<g.length;i++)h.push(Number(g[i].relationType));var j=a.siblings(".bi-owner-tags").find(".tag-yellow").length;return j>0?!1:void(window.confirm("解除客户房屋关系?")&&b({houseId:n,customerId:f},c.parent().parent()))});$("#owner-tagbox");p.on("click",".relation-del",function(){var a=$(this),b=a,c=b.attr("data-id"),d=u[c],e=(d.customerId,[]);$(this).parent().find(".tag:not(.tag-off)").each(function(a,b){e.push($(this).attr("data-code"))});a.siblings(".bi-owner-tags").find(".tag-yellow").length;return!1})}function h(a){for(var b=[],d=[],e=[],f=0;f<a.details.length;f++){var g=a.details[f],h=Page_houseinfo.config.tagObj[g.relationType];"1"==g.relationType?(d.push(g),g.relation=[h],u[g.customerId]=g):(g.relation=h,b.push(g))}for(var i=0;i<b.length;i++){var g=b[i],j=u[g.customerId];j?j.relation.push(g.relation):(g.relation=[g.relation],u[g.customerId]=g,e.push(g))}var k=t({list:d.concat(e)});s.html(k);var k=q({list:e});o.html(k);var k=r({list:d});p.html(k),d.length>1&&p.addClass("bi-owner-two"),l=d,c()}function i(a){o=$("#ownerRelation_list"),q=template.compile($(v.tempid_customerRelation).html()),p=$("#ownerHouserRelation_list"),r=template.compile($(v.tempid_ownerRelation).html()),s=$("#contactsName_list"),t=template.compile($(v.tempid_contactsName).html())}function j(a){m||(m=!0,i(),g()),k(a)}function k(b){n=window.houseId,a({houseId:n})}var l,m=!1,n="",o=null,p=null,q=null,r=null,s=null,t=null,u={},v={url_getRelation:servicePath.customer+"/v1/house/{:id}/customers",url_removeRelation:servicePath.customer+"/v1/customer/houseRelation/remove",tempid_customerRelation:"#ownerRelationTemp",tempid_ownerRelation:"#ownerTemp",tempid_contactsName:"#contactsNameTemp"},w=null;return{init:j}}(),window.house={},function(){function a(){e=$("#ownerHistory_showbtn"),g=$("#btn_transferhouse"),h=$("#btn_houseStatus"),i=$("#btn_houseMegerList"),j=$("#btn_mergeHouseRestore"),f=$("#btn_houseSplit")}function b(){var a=$("#ownerHistory_bar");e.on("click",function(){return a.hasClass("active")?a.removeClass("active"):window.Page_houseinfo.historyinfo.init({houseId:window.houseId}),!1}),g.on("click",function(){Page_houseinfo.transferHouse.init({houseName:window.houseName,houseId:window.houseId})}),f.on("click",function(){Page_houseinfo.houseSplit.init({houseId:window.houseId}),$("#subHouseName").val(""),$("#subHousecheckinTime").val(""),$("#subHouseArea").val("")}),h.on("click",function(){Page_houseinfo.houseStatus.init({status:window.status,houseId:window.houseId,data:Page_houseinfo.info.houseInfo})}),i.on("click",function(){Page_houseinfo.houseMegerList.init({houseId:window.houseId})}),j.on("click",function(){var a=null;if(confirm("确定要复原合并房屋？合并房以及合并房的子房屋将被删除！")){a&&a.abort();var b=servicePath.house+"/v1/house/{:houseId}/mergeHouseRestore";a=Common.ajax({url:b.replace("{:houseId}",houseId),type:"get",data:{houseId:window.houseId},success:function(a){a.success?(alert(a.details),window.location.href=window.path.server+"/page/houses"):alert(a.message)},error:function(){},complete:function(){}})}})}function c(){window.Page_houseinfo.info.init({houseId:window.houseId}),window.Page_houseinfo.relationinfo.init({houseId:window.houseId})}function d(d){k||(k=!0,a(),b()),c(d)}var e,f,g,h,i,j,k=!1;d()}(),window.Page_houseinfo.houseMegerList=function(){function a(a){k&&k.abort(),k=Common.ajax({url:j.url_getHouseMegerList.replace("{:houseId}",h),type:"get",data:a,success:function(a){a.success&&b(a)},error:function(){},complete:function(){}})}function b(a){var b=temp_houseMegerList(a);g.html(b)}function c(){jq_dialog_cancel.on("click",function(){jq_dialog.modal("hide")})}function d(){jq_dialog=$("#modal_houseMegerList"),jq_dialog_cancel=$("#houseMegerList_cancel"),g=$("#houseMegerListTable"),temp_houseMegerList=template.compile($(j.tempid_houseMegerList).html())}function e(b){jq_dialog.modal(),h=window.houseId,a({houseId:h})}function f(a){i||(i=!0,d(),c()),e(a)}var g,h="",i=!1,j={url_getHouseMegerList:servicePath.house+"/v1/house/{:houseId}/getMerger",tempid_houseMegerList:"#houseMegerListTemp"},k=null;return{init:f}}();