window.carport={},window.carport.info=function(){function a(a){s&&s.abort();var b=r.url_getParkingDetail.replace("{:carportId}",a);s=Common.ajax({url:b,type:"get",success:function(a){if(a.success){var b=a;d(b)}},error:function(){},complete:function(){}})}function b(a){t&&t.abort(),t=Common.ajax({url:r.url_dictionary,type:"get",success:function(a){a.success&&(q=a.details,c(q))},error:function(a){alert(a.message)},complete:function(){}})}function c(a){var b=$("#status"),c=template.compile($(r.tempid_select).html());b.html(c({list:a.CarportStatus}))}function d(a){var b=k(a);j.html(b);var c=m(a);l.html(c),p.data=a.details}function e(){j=$("#infoContainer"),k=template.compile($(r.tempid).html()),l=$("#carportTitle"),m=template.compile($(r.addressTempid).html())}function f(){}function g(c){i=window.carportId,b({}),a(i)}function h(a){n||(n=!0,e(),f()),g(a)}var i="",j=null,k=null,l=null,m=null,n=!1,o=["Broadband","HouseStatus"],p={data:null},q=null,r={url_getHouse:servicePath.house+"/v1/house/full",url_gethouseStatus:servicePath.customer+"/v1/batch/dict/"+o+"/items",url_dictionary:servicePath.customer+"/v1/batch/dict/ParkingType,EquityType,CarportStatus/items",url_getParkingDetail:servicePath.house+"/v1/carport/{:carportId}",url_getParkingCustomer:servicePath.house+"/v1/carport/{:carportId}/customer?isdeleted=",tempid:"#carportInfoTemp",addressTempid:"#carportAddressTemp",statusTempid:"#statusTemp",houseBroadbandTempid:"#broadbandTemp",tempid_select:"#selectTemp"},s=null,t=null;return{init:h,houseInfo:p}}(),window.carport.relation=function(){function a(a){n&&n.abort();var b=0,c=m.url_getParkingCustomer.replace("{:carportId}",a.carportId)+b;n=Common.ajax({url:c,type:"get",success:function(a){a.success&&e(a)},error:function(){},complete:function(){}})}function b(a,b){Common.ajax({url:m.url_removeRelation,type:"post",data:a,success:function(a){console.log(a),a.success&&b.remove()},error:function(a){console.log(a)},complete:function(){}})}function c(a){if(a){var b=path.server+"/page/customer/"+a+"/details?carportId="+window.carportId;window.location.href=b}}function d(){k.on("click",".relation-img",function(){var a=$(this).attr("data-id");c(a)}),k.on("click",".relation-del",function(){var a=$(this),c=a.attr("data-id"),d=window.carportId;window.confirm("解除客户车位关系?")&&b({carportId:d,customerIds:c},a.parent().parent())})}function e(a){var b=l(a);k.html(b);var c=$("#contactsId"),d=template.compile($(m.tempid_contacts).html());c.html(d({list:a.details}))}function f(a){k=$("#ownerRelation_list"),l=template.compile($(m.tempid_customerRelation).html())}function g(a){i||(i=!0,f(),d()),h(a)}function h(b){j=window.carportId,a({carportId:j})}var i=!1,j="",k=null,l=null,m={url_getRelation:servicePath.customer+"/v1/customer/house",url_removeRelation:servicePath.customer+"/v1/carport/removeRelation",url_getParkingDetail:servicePath.house+"/v1/carport/{:carportId}",url_getParkingCustomer:servicePath.house+"/v1/carport/{:carportId}/customer?isdeleted=",tempid_customerRelation:"#ownerRelationTemp",tempid_ownerRelation:"#ownerTemp",tempid_contactsName:"#contactsNameTemp",tempid_contacts:"#contactsTemp"},n=null;return{init:g}}(),window.carport.history=function(){function a(a){n&&n.abort();var b=1,d=l.url_getParkingCustomer.replace("{:carportId}",a.carportId)+b;n=Common.ajax({url:d,type:"get",success:function(a){a.success&&c(a)},error:function(){},complete:function(){}})}function b(){h.on("click",function(){return g.removeClass("active"),!1})}function c(a){var b=k(a);i.html(b)}function d(a){g=$("#ownerHistory_bar"),i=$("#ownerHistory_list"),h=$("#ownerHistory_close"),k=template.compile($(l.tempid_history).html())}function e(a){j=window.carportId,g.addClass("active")}function f(c){m||(d(),b()),e(c),a({carportId:j})}var g,h,i,j,k,l={url_getHistory:servicePath.customer+"/v1/customer/house/history",url_getParkingDetail:servicePath.house+"/v1/carport/{:carportId}",url_getParkingCustomer:servicePath.house+"/v1/carport/{:carportId}/customer?isdeleted=",tempid_history:"#ownerHistoryTemp"},m=!1,n=null;return{init:f}}(),window.carport.subscribe=function(){function a(a){var b=d(a);c.html(b)}function b(b){c=$("#dtn-PropertyServiceBox"),d=template.compile($(e.tempid_TakeRelation).html()),a({})}var c,d,e={url_getRelation:servicePath.task+"/v1/callcenter/task/app/list",url_getProperty:servicePath.house+"/v1/subscription/propertyFee",url_getParcel:servicePath.house+"/v1/subscription/parcel",url_getParkingDetail:servicePath.house+"/v1/carport/{:carportId}",url_getParkingCustomer:servicePath.house+"/v1/carport/{:carportId}/customer?isdeleted=",tempid_TakeRelation:"#TakeRelation",tempid_Parcel:"#Parcel"};return{init:b}}(),window.carport.status=function(){function a(a){l&&l.abort(),a.carportId=window.carportId,l=Common.ajax({url:k.url_updateCarportStatus,type:"post",data:a,success:function(a){a.success?(alert("操作成功."),h.modal("hide"),window.location.reload()):alert("操作失败.")},error:function(){alert("操作失败.")}})}function b(){i.on("click",function(){var b=Common.getFormData($("#modal_carportStatus_form").get(0));a(b)}),j.on("click",function(){h.modal("hide"),window.location.reload()})}function c(){h=$("#modal_carportStatus"),i=$("#carportStatus_ok"),j=$("#carportStatus_cancel")}function d(a){f=window.carportId,Common.setFormData($("#modal_carportStatus_form").get(0),a.data.data),h.modal("show")}function e(a){g||(g=!0,c(),b()),d(a)}var f="",g=!1,h=null,i=null,j=null,k={url_getRelation:servicePath.customer+"/v1/customer/carportCheckin",url_updateCarportStatus:servicePath.house+"/v1/carport/"+window.carportId,url_dictionary:servicePath.customer+"/v1/batch/dict/ParkingType,EquityType,CarportStatus/items",url_getCarportContacts:servicePath.house+"/v1/carport/{:carportId}/customer?isdeleted=",tempid_relation:"#transferCarportTemp",tempid_subCarport:"#subCarportTemp"},l=null;return{init:e}}(),function(){window.carport.info.init(window.carportId),window.carport.relation.init(window.carportId),window.carport.subscribe.init(window.carportId);var a=$("#ownerHistory_showbtn"),b=$("#ownerHistory_bar"),c=$("#btn_carportStatus");a.on("click",function(){return b.hasClass("active")?b.removeClass("active"):window.carport.history.init(window.carportId),!1}),c.bind("click",function(){window.carport.status.init({data:carport.info.houseInfo})})}();