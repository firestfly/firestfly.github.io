function validateIdcard(){if("1"!==$("[name='basic.certificateType']").val())return{isError:!1};var a=$("[name='basic.certificateId']").val().toUpperCase();if(""==a)return{isError:!1};var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "},c="",d=!0;if(a&&/^[1-9][0-9]{5}(19[0-9]{2}|200[0-9]|2010)(0[1-9]|1[0-2])(0[1-9]|[12][0-9]|3[01])[0-9]{3}[0-9xX]$/i.test(a))if(b[a.substr(0,2)]){if(18==a.length){a=a.split("");for(var e=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],f=[1,0,"X",9,8,7,6,5,4,3,2],g=0,h=0,i=0,j=0;17>j;j++)h=a[j],i=e[j],g+=h*i;f[g%11];f[g%11]!=a[17]&&(c="校验位错误",d=!1)}}else c="地址编码错误",d=!1;else c="身份证号格式错误",d=!1;return d||console.log(c),{isError:!d,errorInfo:c}}!function(){function a(){$("#addUserBtn").bind("click",function(){g(),$(".c_form").slideDown(),$(".c_search").slideUp()}),$("#searchBtn").bind("click",function(){var a="";if($("#searchForm").find("input").each(function(){a+=$(this).val()}),""==a)alert("请输入查询条件");else{var c=Common.getFormData($("#searchForm")[0]);c.houseId=window.houseId,b(c)}}),$("#customerTableBody").on("click","a",function(){var a=$(this).attr("data-id"),b=Common.getFormData($("#"+a)[0]);if(!b.relationType)return void alert("请选择客户与房屋关系.");var d=b.relationType;d.indexOf("1")>=0&&d.indexOf("3")>0?($("#"+a)[0].reset(),alert("居住与租赁关系不能同时存在.")):(b.customerId=a,b.houseId=window.houseId,c(b))}),$("#addc_form_btn").bind("click",function(){$("#form_Customer").find(".errortip").removeClass("on").tooltip("destroy"),$("#form_CustomerDetail").find(".errortip").removeClass("on").tooltip("destroy"),$("#form_houseRel").find(".errortip").removeClass("on").tooltip("destroy");var a=validate($("#form_Customer")[0],{validateAll:!0,onerror:function(a,b){$(a).closest("td").find(".errortip").addClass("on").tooltip({title:b,placement:"bottom"})}}),b=validate($("#form_CustomerDetail")[0],{validateAll:!0,onerror:function(a,b){$(a).closest("td").find(".errortip").addClass("on").tooltip({title:b,placement:"bottom"})}}),c=!1;Common.getFormData(form_houseRel).houseRelationTypes||(c=!0,$("#form_houseRel").find(".errortip").addClass("on").tooltip({title:"请选择一种客房关系",placement:"bottom"})),a||b||c||l(houseId)}),$("#cancelc_form_btn").bind("click",function(){$(".c_form").slideUp(),$(".c_search").slideDown(),$("#form_Customer")[0].reset(),$("#form_CustomerDetail")[0].reset(),$("#form_hobbies")[0].reset(),$("#form_houseRel")[0].reset(),$("#form_kehuRel")[0].reset(),$("#form_Specialidentity")[0].reset()}),$(document).on("click","[name='houseRelationTypes']",function(a){var b=$(this).val();1==b&&$("[name='houseRelationTypes'][value='3']").removeAttr("checked"),3==b&&$("[name='houseRelationTypes'][value='1']").removeAttr("checked")})}function b(a){S&&S.abort(),S=Common.ajax({url:Q.url_seacth_list,type:"get",data:a,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(a){a.success&&d(a)},error:function(a){},complete:function(){}}),Common.loading({text:"",container:"#customerTableDiv",handle:S})}function c(a){T&&T.abort(),T=Common.ajax({url:Q.url_NewhouseRel,type:"post",data:a,success:function(a){a.success?(alert("新增与房屋关系成功，即将跳转页面."),window.location.href=Q.url_detail):alert(a.message)},error:function(a){alert(a.message)},complete:function(){}})}function d(a){var b=s(a);r.html(b);var c=a.details.customers.pagination;R.render({curpage:c.curPage,pagesize:c.pageSize,totalpage:c.totalPage,totalsize:c.totalSize}),R.pagesize=c.pageSize}function e(){U&&U.abort(),U=Common.ajax({url:Q.url_getcustomerlist,type:"get",success:function(a){a.success&&f(a)},error:function(a){},complete:function(){}})}function f(a){var b=q(a);p.html(b),$(".relationselect").html(L({list:M}))}function g(){V&&V.abort(),V=Common.ajax({url:Q.url_dictionary,type:"POST",data:{codes:"CustomerAffilication,CustomerSex,CustomerType,CustomerIdentity,CustomerHobbies,HouseCustomerRelationType,CustomerRelationType,CustomerOccupation,CustomerBlood,CustomerCertificateType#CRMv2"},success:function(a){a.success&&(i(a),e())},error:function(a){},complete:function(){}})}function h(a){W&&W.abort(),W=Common.ajax({url:Q.url_CustomerApproveStatus,type:"POST",data:a,success:function(a){a.success?(alert("新增客户信息成功，即将跳转工作台."),window.location.href=Q.url_workspace):alert(a.message)},error:function(a){},complete:function(){}})}function i(a){var b=w(a),c=y(a),d=A(a),e=C(a),f=E(a),g=G(a),h=I(a),i=K(a),j=u(a);v.html(b),x.html(c),z.html(d),B.html(e),D.html(f),F.html(g),H.html(h),J.html(i),t.html(j);var k=a.details.CustomerRelationType;M=k,m()}function j(){t=$("#_d_cardType"),v=$("#_d_customerType"),x=$("#_d_affiliation"),z=$("#_d_sex"),B=$("#_d_job"),D=$("#_d_bloodType"),F=$("#_d_hobby"),H=$("#_d_sp"),J=$("#_d_houseRel"),u=template.compile($(Q.d_cardTypeTempId).html()),w=template.compile($(Q.d_customerTypeTempId).html()),y=template.compile($(Q.d_affiliationTempId).html()),A=template.compile($(Q.d_sexTempId).html()),C=template.compile($(Q.d_jobTempId).html()),E=template.compile($(Q.d_bloodType).html()),G=template.compile($(Q.d_hobby).html()),I=template.compile($(Q.d_sp).html()),K=template.compile($(Q.d_houseRelTempId).html())}function k(){r=$("#customerTableBody"),p=$("#_view_customer_listBody"),s=template.compile($(Q.searchTempId).html()),q=template.compile($(Q.formTempId).html()),L=template.compile($(Q.selectTemplate).html())}function l(a){$("#addc_form_btn").hide();var b=Common.getFormData(form_Customer),c=Common.getFormData(form_CustomerDetail),d=Common.getFormData(form_hobbies),e=Common.getFormData(form_Specialidentity),f=Common.getFormData(form_starttime),g=Common.getFormData(form_chixutime),i=a,j=Common.getFormData(form_kehuRel),k=Common.getFormData(form_houseRel),l={},m={},n={},o={},p={},q={},r={},s={},t={};r.houseId=i,l=b,m=c,n=d,o=e,p=f,q=g,s=j,t=k;for(var u=$.extend({},s),v=u.customerId&&u.customerId.split(",")||[],w=u.relationType&&u.relationType.split(",")||[],x={},y=0;y<v.length;y++)x["customerRelations["+y+"].customerId"]=v[y];for(var z=0;z<w.length;z++)x["customerRelations["+z+"].relationType"]=w[z];for(var A=$.extend({},e),B=A.identity&&A.identity.split(",")||[],C={},D=0;D<B.length;D++)C["identities["+D+"].identity"]=B[D];for(var E=0;E<B.length;E++)C["identities["+E+"].duration"]=A.duration;for(var F=0;F<B.length;F++)C["identities["+F+"].beginDate"]=A.beginDate;var G=$.extend({},n,r,t,l,m,x,C);console.log(G),Common.ajax({url:Q.url_submitForm,type:"post",data:G,success:function(a){if($("#addc_form_btn").show(),a.success)if(window.pendingId){var b={customerId:window.pendingId,crmCustomerId:a.details};h(b)}else alert("新增与房屋关系成功，即将跳转页面."),window.location.href=Q.url_detail;else alert(a.message)},error:function(a){$("#addc_form_btn").show(),alert("保存失败："+a.message)},complete:function(){}})}function m(){var a=$(".addc_specialidentity").find("input");a.each(function(){"8"==$(this).val()&&$(this).click(function(){$(".jiufen").toggleClass("on"),$("._begintime").attr("name","beginDate"),$("._staytime").attr("name","duration")})})}function n(){}function o(b){N||(N=!0,a(),k(),j(),window.pendingId&&($(".c_search").slideDown(),$(".c_form").slideUp(),$("#cancelc_form_btn").hide(),$("#cancelToWorkbench_btn").show(),g(),$(".c_form").slideDown(),$(".c_search").slideUp())),$(document).ready(function(){var a="customerInfo=",b=location.search.indexOf(a);if(-1!=b){var c=location.search.substr(b+a.length);c=unescape(c),c=$.parseJSON(c),setTimeout(function(){$("#check_name").val(c.fullName),$("#check_idcard").val(c.certificateId),$("#_d_cardType").val(c.certificateType),$("input[name='basic.mainMobile']").val(c.mainMobile),$("input[name='basic.standbyMobile']").val(c.standbyMobile),$("input[name='basic.officeTel']").val(c.officeTel),$("input[name='basic.homeTel']").val(c.homeTel)},500),c.sex=Number(c.sex)-1,void 0==c.sex&&null==c.sex||setTimeout(function(){$("input[name='basic.sex']")[c.sex].checked=!0;var a=c.tags;a=a?a.split(","):[];var b=c.identities;b=b?b.split(","):[];for(var d=0;d<a.length;d++){var e="input[name='hobbies'][value='"+a[d]+"']";$(e).attr("checked","true")}for(var d=0;d<b.length;d++){var e="input[name='identity'][value='"+b[d]+"']";$(e).attr("checked","true")}if(c.relationType)for(var f=c.relationType.split(","),d=0;d<f.length;d++)void 0!=f[d]&&($("input[name='houseRelationTypes']")[d].checked=!0)},1e3)}}),n(b)}var p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=!1,O=1,P=10,Q={url_NewhouseRel:servicePath.customer+"/v1/customer/houseRelation/bind",url_seacth_list:servicePath.customer+"/v1/customer/queryCustomer4Search/"+O+"/"+P,url_submitForm:servicePath.customer+"/v1/customer",url_getcustomerlist:servicePath.customer+"/v1/customer/house/"+houseId+"/owners",url_dictionary:servicePath.customer+"/v1/dict/items",url_CustomerApproveStatus:servicePath.customer+"/v1/customer/approveStatus",url_detail:path.server+"/page/house/"+houseId+"/details",url_workspace:path.server+"/page/workspace",url_NewhouseRel:servicePath.customer+"/v1/customer/houseRelation/bind",formTempId:"#__view_customer_listBody",searchTempId:"#__view_search_list",d_cardTypeTempId:"#__d_cardType",d_customerTypeTempId:"#__d_customerType",d_affiliationTempId:"#__d_affiliation",d_sexTempId:"#__d_sex",d_jobTempId:"#__d_job",d_bloodType:"#__d_bloodType",d_hobby:"#__d_hobby",d_sp:"#__d_sp",d_houseRelTempId:"#__d_houseRel",selectTemplate:"#selectTemplate",checkboxTemplate:"#checkboxTemplate"},R=new Pagination({template:"#paginationtmpl",selector:"#pagination",onchange:function(a){O=a.curpage,P=a.pagesize,Q.url_seacth_list=servicePath.customer+"/v1/customer/queryCustomer4Search/"+O+"/"+P;var c=Common.getFormData(searchForm);c.houseId=window.houseId,b(c)}}),S=null,T=null,U=null,V=null,W=null;o()}();