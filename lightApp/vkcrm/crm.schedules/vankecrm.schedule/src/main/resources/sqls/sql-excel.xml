<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>Excel异步导入相关的sql</comment>
	
	<!--根据userId获取用户信息，包括用户组织信息-->
	<entry key="profile.getProfiles">
	<![CDATA[
		SELECT SP.ID,
		       SP.NAME,
		       SP.DESCRIPTION,
		       (CASE WHEN SP.ACTIVATE = 1 THEN '是' else '否' END) ACTIVATE ,
		       (CASE WHEN SP.GLOBAL = 1 THEN '是' else '否' END) GLOBAL
		FROM   SYS_PROFILE SP
		WHERE 1=1
		{? AND SP.NAME = #NAME#}
		{? AND    SP.ACTIVATE = #activate#}
		{? AND    SP.GLOBAL = #global#}
		{? AND    SP.ID <> #profileId#}
	]]>
	</entry>
	
	<!--根据BUSINESS_TYPE(对应excel_import表中import_id字段)获取IMPORTER_SPRING_ID-->
	<entry key="ExcelImportLogService.getDealExcelFileSpringId">
	<![CDATA[
		SELECT T.IMPORTER_SPRING_ID
		  FROM EXCEL_IMPORT T
		 WHERE T.IMPORT_ID = #businessType#
	]]>
	</entry>
	
	<entry key="ExcelImportLogService.getIUserByLoginId">
    <![CDATA[
        select * from SEC_USER where id = #loginId#
    ]]>
    </entry>
    
    <entry key="ExcelImportLogService.getExcelImportLogBySrcFilePath">
    <![CDATA[
        select * from EXCEL_IMPORT_LOG T where T.SRC_FILE_SAVE_PATH = #srcFileSavePath#
    ]]>
    </entry>
    
    <entry key="ExcelImportLogService.getExcelImportLogList">
    <![CDATA[
        select *
		  from EXCEL_IMPORT_LOG t
		 where t.operate_status != '已处理'
		 order by t.upload_time
    ]]>
    </entry>
    
    <entry key="ExcelImportLogService.getExcelImportLog">
    <![CDATA[
        SELECT *
		  FROM (SELECT *
		          FROM EXCEL_IMPORT_LOG T
		         WHERE T.OPERATE_STATUS != '已处理'
		         ORDER BY T.UPLOAD_TIME)
		 WHERE ROWNUM = 1
    ]]>
    </entry>
	
	<!-- 记录开始处理信息 -->
	<entry key="ExcelImportLogService.startDealExcelFile">
	<![CDATA[
		UPDATE EXCEL_IMPORT_LOG T
		   SET T.DEAL_BEGIN_TIME    = now(),
		       T.TOTAL_NUMS         = #totalNums#,
		       T.DEALING_NUM        = 0,
		       T.ERROR_NUMS         = 0,
		       T.SUCCESS_NUMS       = 0,
		       T.VALIDATE_PASS_NUMS = 0,
		       T.OPERATE_STATUS     = #operateStatus#,
		       T.LAST_UPDATED_BY    = 'schedule',
		       T.LAST_UPDATED_DATE  = now()
		 WHERE T.PID = #pid#
	]]>
	</entry>
	
	<!-- 更新处理进度信息 -->
	<entry key="ExcelImportLogService.updateDealExcelFile">
	<![CDATA[
		UPDATE EXCEL_IMPORT_LOG T
		   SET T.DEALING_NUM        = #dealingNum#,
		       T.ERROR_NUMS         = #errorNums#,
		       T.VALIDATE_PASS_NUMS = #validatePassNums#,
		       T.SUCCESS_NUMS       = #successNums#,
		       T.LAST_UPDATED_BY    = 'schedule',
		       T.LAST_UPDATED_DATE  = now()
		 WHERE T.PID = #pid#
	]]>
	</entry>
	
	<!-- 保存处理结果信息 -->
	<entry key="ExcelImportLogService.endDealExcelFile">
	<![CDATA[
		UPDATE EXCEL_IMPORT_LOG T
		   SET T.DEAL_END_TIME       = now(),
		       T.DEALING_NUM         = #dealingNum#,
		       T.VALIDATE_PASS_NUMS  = #validatePassNums#,
		       T.ERROR_NUMS          = #errorNums#,
		       T.SUCCESS_NUMS        = #successNums#,
		       T.OPERATE_STATUS      = #operateStatus#,
		       T.OPERATE_RESULT_INFO = #operateResultInfo#,
		       T.RESULT_FILE_PATH    = #resultFilePath#,
		       T.LAST_UPDATED_BY     = 'schedule',
		       T.LAST_UPDATED_DATE   = now()
		 WHERE T.PID = #pid#
	]]>
	</entry>
	
</properties>