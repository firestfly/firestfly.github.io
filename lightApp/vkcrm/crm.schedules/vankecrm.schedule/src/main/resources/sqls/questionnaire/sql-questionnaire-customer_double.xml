<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>Excel异步导入相关的sql</comment>


	<entry key="sql-sati-extractionCustomerRemoveDouble-insert-tmp1">
	<![CDATA[		
		/* 插入重复客户信息 */
		INSERT into sati_extraction_double
		  (id_id,project_id,main_mobile)
		  select max(tc2.id) as id,tc2.project_id,tc2.main_mobile
		    from sati_extraction_customer tc2
		   group by tc2.main_mobile,tc2.project_id
		  having count(*) > 1
	]]>
	</entry>
	<entry key="sql-sati-extractionCustomerRemoveDouble-update-tmp2">
	<![CDATA[
		/* 修改重复号码为空 */
		UPDATE sati_extraction_customer c5
		  JOIN sati_extraction_double d6 ON c5.main_mobile = d6.main_mobile AND c5.project_id = d6.project_id
		   SET c5.main_mobile = NULL
	]]>
	</entry>	
	<entry key="sql-sati-extractionCustomerRemoveDouble-update-tmp3">
	<![CDATA[
		/* 保留一个号码 */
		UPDATE sati_extraction_customer c5
		  JOIN sati_extraction_double d6 ON c5.id = d6.id_id
		   SET c5.main_mobile = d6.main_mobile
	]]>
	</entry>
	<entry key="sql-sati-extractionCustomerRemoveDouble-delete-tmp4">
	<![CDATA[
		/* 清除其它号码 */
		delete from sati_extraction_customer where main_mobile is null
	]]>
	</entry>
	
	
	
	<entry key="sql-sati-extractionCustomerRemoveDouble-insert-tmp11">
	<![CDATA[	-- 插入预约客户到临时表
		insert into sati_extraction_double
		  (customer_id,project_id)
		  select s.customer_id,s.project_id
		    from sati_extraction_subscribe s
		   where s.appointment_time is not null
	]]>
	</entry>	
	<entry key="sql-sati-extractionCustomerRemoveDouble-delete-tmp12">
	<![CDATA[	-- 删除已经有预约的强制抽取客户
		delete from sati_extraction_subscribe
		 where customer_id in (select d.customer_id from sati_extraction_double d)
		   and appointment_time is not null
	]]>
	</entry>	
	<entry key="sql-sati-extractionCustomerRemoveDouble-insert-tmp21">
	<![CDATA[	-- 插入重复强制抽取客户到临时表
		INSERT into sati_extraction_double
		  (id_id, customer_id,project_id)
		  select max(tc2.id) as id, tc2.customer_id,project_id
		    from sati_extraction_subscribe tc2
		   where tc2.appointment_time is not null
		   group by tc2.customer_id,project_id
		  having count(*) > 1
	]]>
	</entry>	
	<entry key="sql-sati-extractionCustomerRemoveDouble-update-tmp22">
	<![CDATA[
		/* 修改重复号码为空 */
		UPDATE sati_extraction_subscribe s4
		  JOIN sati_extraction_double d6 ON s4.customer_id = d6.customer_id AND s4.project_id = d6.project_id
		   SET s4.customer_id = NULL
	]]>
	</entry>	
	<entry key="sql-sati-extractionCustomerRemoveDouble-update-tmp23">
	<![CDATA[
		/* 保留一个号码 */
		UPDATE sati_extraction_subscribe s4
		  JOIN sati_extraction_double d6 ON s4.id = d6.id_id
		   SET s4.customer_id = d6.customer_id
	]]>
	</entry>
	<entry key="sql-sati-extractionCustomerRemoveDouble-delete-tmp24">
	<![CDATA[
		/* 清除其它号码 */
		delete from sati_extraction_subscribe where customer_id is null
	]]>
	</entry>
	 
	
</properties>