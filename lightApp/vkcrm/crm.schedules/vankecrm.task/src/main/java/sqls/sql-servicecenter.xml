<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <!-- 获取当前房屋的信息 -->
    <entry key="sql.select.organization">
        <![CDATA[
         select
         mph.projectid as ProjectId,
         (select name from tree_organization where id = mph.projectid and leveltype = '4') as ProjectName,
         mph.gridid as GridId,
         (select name from main_grid where id = mph.gridid ) as GridName,
         tor.parentid as OrganizationId,
         (select name from tree_organization where id = tor.parentid and leveltype = '3') as OrganizationName,
         (select id from tree_organization where id = (select parentid from tree_organization where id = tor.parentid) and leveltype = '2') as ManageCenterId,
         (select name from tree_organization where id =  (select parentid from tree_organization where id = tor.parentid) and leveltype = '2') as ManageCenterName
         from mid_project_house mph
         left join tree_organization tor on tor.id = mph.projectid
         where 1 = 1
         and mph.houseId = #HouseId#
    ]]>
    </entry>

    <!-- 获取定时任务上次同步时间-->
    <entry key="sql.select.bmaplog">
        <![CDATA[
        select syn_time from log_bmap_syn where service_code=#syncCode# order by syn_time  limit 1
    ]]>
    </entry>



    <!-- 查询一个项目编码是否存在-->
    <entry key="sql.exist.project">
        <![CDATA[
        select count(1) from main_project where code=#projectCode#
    ]]>
    </entry>

    <!-- 查询一个项目是否在项目管理中心中间表中存在-->
    <entry key="sql.exist.project.">
        <![CDATA[
        select count(1) from main_project where code=#projectCode#
    ]]>
    </entry>
    <!-- 更新项目信息-->
    <entry key="sql.update.sync.project">
        <![CDATA[
        update main_project set name=#abrev#,companyCode=#companyCode#,
        companyName=#companyName#,projecttype=#projectType#,projectsource=#projectSource#,
        name_formal=#nameFormal#,citycode=#cityCode#,isDeleted=#isDeleted#
        where code=#projectCode#
    ]]>
    </entry>
    <!-- 新增项目信息-->
    <entry key="sql.insert.sync.project">
        <![CDATA[
        insert into main_project (`id`,`code`,`name`,`name_formal`,`companyCode`,`companyName`,`projecttype`,`projectsource`,`cityCode`,`isDeleted`)
        values(#id#,#projectCode#,#abrev#,#projectName#,#companyCode#,#company#,#projectType#,#projectSource#,#cityCode#,#isDeleted#)
    ]]>
    </entry>

    <!--新增的项目信息插入到树结构中-->
    <entry key="sql.insert.tree.project">
        <![CDATA[
        insert into tree_organization(`id`,`parentId`,`name`,`levelType`,`levelTypeText`,`createTime`,`isDeleted`)
        VALUES(#id#,(SELECT id from tree_organization t
        where levelType=3 and(SUBSTRING(t.name,1,3) = (select MCCode from mid_project_mc where projectCode=#projectCode# limit 1))),
        #name#,'4','PRJ',now(),#isDeleted#)
    ]]>
    </entry>

    <!-- 更新项目树信息-->
    <entry key="sql.update.sync.tree">
        <![CDATA[
        update tree_organization set name=#projectName#,isDeleted=#isDeleted#
        where id =(select id from main_project where code=#projectCode# limit 1)
    ]]>
    </entry>

    <!-- 更新楼栋树信息-->
    <entry key="sql.update.tree.building">
        <![CDATA[
        update tree_organization set name = #name#,isDeleted=#isDeleted#
        where id = #id#
    ]]>
    </entry>

    <!-- 插入楼栋树信息-->
    <entry key="sql.insert.tree.building">
        <![CDATA[
       insert into tree_organization values
       (#id#,(select id from main_project where code=#parentId# LIMIT 1),#name#,'5','BLD',null,now(),#isDeleted#,null)
    ]]>
    </entry>

    <!-- 插入房屋基本信息-->
    <entry key="sql.insert.houseBasic">
        <![CDATA[
        insert into main_house(`id`,`code`,`name`,`name_formal`,`assistCode`,`projectId`,`buildingCode`,`status`,`buildingName`,`buildingName_formal`,
        `unit`,`floor`,`roomNumber`,`equityType`,`checkInTime`,`deliverTime`,`type`,`modifyTime`,`syncTime`)
        VALUES (#id#,#code#,#name#,#nameFormal#,#assistCode#,(select id from main_project where code = #projectCode# limit 1),#buildCode#,#status#,
        #buildingAbrev#,#buildingName#,
        #unit#,#floor#,#roomNumber#,#equityType#,#checkInTime#,#deliverTime#,#type#,#statusuptime#,#syncTime#)
    ]]>
    </entry>

    <!-- 插入房屋详细信息-->
    <entry key="sql.insert.houseDetail">
        <![CDATA[
       insert into main_house_detail(`id`,`floor`,`unit`,`orientation`,`builtUpArea`,`setArea`,`layout`,`modifyTime`)
        VALUES (#id#,#floor#,#unit#,#orientation#,#builtUpArea#,#setArea#,
        (select layoutCode from  house_layout  where layoutName = #layout# LIMIT 1),#statusuptime#)
    ]]>
    </entry>

    <!-- 插入车位信息-->
    <entry key="sql.insert.carport">
        <![CDATA[
        insert into main_carport(`id`,`code`,`name`,`projectId`,`carparkId`,`parkingtype`,`equitytype`,`area`,`modifyTime`,`isDeleted`)
        values(#id#,#parkcode#,#location#,(select id from main_project where code=#projectCode# limit 1),
        (select id from main_carpark where `code` = #lotcode# LIMIT 1),
        #parkingtype#,#prpright#,#parkarea#,#statusuptime#,#isDeleted#)
    ]]>
    </entry>



    <!-- 插入车场信息-->
    <entry key="sql.insert.carpark">
        <![CDATA[
        insert into main_carpark(`id`,`code`,`name`,`projectId`,`syncTime`,`isDeleted`)
        values(#id#,#lotcode#,#lotnm#,(select id from main_project where code=#projcode# limit 1),#statusuptime#,#isDeleted#)
    ]]>
    </entry>


    <!-- 更新车场信息-->
    <entry key="sql.update.carpark">
        <![CDATA[
       update main_carpark set `name`=#lotnm#,
       `projectId`=(select id from main_project where code=#projcode# limit 1),
       syncTime=#statusuptime#,
       isDeleted=#isDeleted#
       where `code` = #lotcode#
    ]]>
    </entry>

    <!--判断一个房屋存不存在-->
    <entry key="sql.exist.house">
        <![CDATA[
        select count(1) from main_house where code=#code#
    ]]>
    </entry>

    <!--判断一个车位存不存在-->
    <entry key="sql.exist.carport">
        <![CDATA[
        select count(1)  from main_carport where code=#code#
    ]]>
    </entry>

    <!--判断一个车位存不存在-->
    <entry key="sql.exist.carpark">
        <![CDATA[
        select count(1)  from main_carpark where code=#code#
    ]]>
    </entry>
    <!--更新车位信息-->
    <entry key="sql.update.carport">
        <![CDATA[
        update main_carport set name=#location#,projectId=(select id from main_project where code=#projectCode# LIMIT 1),
        carparkid=(select id from main_carpark where `code` = #lotcode# LIMIT 1),
        parkingtype=#parktype#,equitytype=#prpright#,area=#parkarea#,modifyTime=#statusuptime#,isDeleted=#isDeleted#
        where code=#parkcode#
    ]]>
    </entry>




    <!--更新房屋基本信息-->
    <entry key="sql.update.houseBasic">
        <![CDATA[
        update main_house set name=#name#,assistCode=#assistCode#,unit=#unit#,floor=#floor#,roomNumber=#roomNumber#,
        checkInTime=#checkInTime#,deliverTime=#deliverTime#,equityType=#equityType#,name_formal=#nameFormal#,
        modifyTime=#statusuptime#,buildingName=#buildingAbrev#,type=#type#,
        buildingName_formal=#buildingName#,
        buildingCode=#buildCode#,
        projectId=(select id from main_project where code = #projectCode# limit 1),
        syncTime=#syncTime#
        where code=#code#
    ]]>
    </entry>


    <!--更新房屋详细信息-->
    <entry key="sql.update.houseDetails">
        <![CDATA[
        update main_house_detail set
        floor=#floor#,
        unit=#unit#,
        orientation=#orientation#,
        builtUpArea=#builtUpArea#,
        setArea=#setArea#,
        layout=(select layoutCode  from  house_layout  where layoutName=#layout# LIMIT 1),
        modifyTime=#statusuptime#
        where id =(select id from main_house where code=#code# limit 1)
    ]]>
    </entry>


    <!--更新中间表的数据-->
    <entry key="sql.update.midprojecthouse">
        <![CDATA[
        update mid_project_house a set
        a.projectId=(select id from main_project WHERE code = #projectCode# LIMIT 1),
        buildingId = #buildCode#,
        buildingCode = #buildCode#,
        buildingName = #buildingAbrev#,
        unitId = #unitId#,
        unit = #unit#,
        floor  = #floor#,
        number = #roomNumber#
        where houseId=(select id from main_house where code = #code# LIMIT 1)
    ]]>
    </entry>








    <!-- 获取所有项目code-->
    <entry key="sql.query.allProjectCode">
        <![CDATA[
        select code from main_project
    ]]>
    </entry>




    <!-- 获取已经同步的项目code-->
    <entry key="sql.query.SyncedProjectInfo">
        <![CDATA[
        select projectCode from sync_log where syncCode = #syncCode#
        and requestTime = #requestTime#  and isSuccessed=1
    ]]>
    </entry>



    <!-- 获取所有项目信息-->
    <entry key="sql.query.allprojectInfo">
        <![CDATA[
        select code from main_project
    ]]>
    </entry>


    <!--&lt;!&ndash; 插入项目树下楼栋信息 &ndash;&gt;-->
    <!--<entry key="sql.insert.treeBuilding">-->
    <!--<![CDATA[-->
    <!--select code from main_project-->
    <!--]]>-->
    <!--</entry>-->

    <!-- 判断一个楼栋ID存不存在与tree表中 -->
    <entry key="sql.exist.building">
        <![CDATA[
        select count(1) from tree_organization where id =#buildingCode#
    ]]>
    </entry>

    <!-- 测试数据 -->
    <entry key="sql.query.treeBuild">
        <![CDATA[
        select id from tree_organization where levelType =5
    ]]>
    </entry>

    <!-- 更新公司名称(main_company和tree表) -->
    <entry key="sql.update.companyInfo">
        <![CDATA[
        update tree_organization tro LEFT JOIN main_company mc on mc.id=tro.id set tro.name=#companyName#,mc.companyname=#companyName#
        where mc.companyCode=#companyCode#
    ]]>
    </entry>
    <!--插入公司主表数据-->
    <entry key="sql.insert.companyInfo">
        <![CDATA[
        insert into main_company(`id`,`companyCode`,`companyName`,`isdeleted`)
        VALUES(#id#,#companyCode#,#companyName#,0)
    ]]>
    </entry>

    <!-- 插入树结构数据 -->
    <entry key="sql.insert.tree">
        <![CDATA[
        insert into tree_organization(`id`,`parentId`,`name`,`levelType`,`levelTypeText`,`isouter`,`createtime`,`isdeleted`)
        VALUES(#id#,#parentId#,#name#,#levelType#,#levelTypeText#,#isOuter#,NOW(),0)
    ]]>
    </entry>


    <!-- 判断一个单元ID是否存在于树结构表中 -->
    <entry key="sql.exist.unit">
        <![CDATA[
        select count(1) from tree_organization where levelType=6 and id = #unit#
    ]]>
    </entry>

    <!-- 判断一个项目是否存在于树结构表中 -->
    <entry key="sql.exist.project4Tree">
        <![CDATA[
        select count(1) from tree_organization where id =(select id from main_project where code = #code# limit 1)
    ]]>
    </entry>

    <!-- 根据项目code获取项目ID（用于插入树结构中） -->
    <entry key="sql.query.projectIdByCode">
        <![CDATA[
        select id from main_project where code = #code#
    ]]>
    </entry>


    <!-- 查询一个项目属于哪个运营中心 -->
    <entry key="sql.query.belongMc">
        <![CDATA[
        select mccode from mid_project_mc where projectCode=#code#
    ]]>
    </entry>

    <!-- 判断一个公司存不存在 -->
    <entry key="sql.exist.company">
        <![CDATA[
        select count(1) from main_company where companyCode=#companyCode#
    ]]>
    </entry>


    <!-- 通过公司code判断一个公司是否存在于树结构中 -->
    <entry key="sql.exist.companyByCode4Tree">
        <![CDATA[
       select count(1) from tree_organization a INNER JOIN main_company b on a.id=b.id
       where b.companyCode=#companyCode#
    ]]>
    </entry>

    <!-- 通过公司code查询公司ID -->
    <entry key="sql.query.companyIdByCode">
        <![CDATA[
          select id from main_company where companyCode=#companyCode#
    ]]>
    </entry>

    <!-- 查询所有公司code -->
    <entry key="sql.query.allCompanyCode">
        <![CDATA[
          select companyCode from main_company
    ]]>
    </entry>

    <!-- 通过公司code查询公司ID -->
    <entry key="sql.insert.tree.project4Office">
        <![CDATA[
        insert into tree_organization(`id`,`parentId`,`name`,`levelType`,`levelTypeText`,`createTime`,`isDeleted`)
        VALUES(#id#,(select id from main_company where CompanyCode=#companyCode# limit 1),
        #name#,'4','PRJ',now(),#isDeleted#)
    ]]>
    </entry>

    <!-- 插入项目房屋中间表 -->
    <entry key="sql.insert.projectHouse">
        <![CDATA[
        insert into mid_project_house(`houseId`,`projectId`,`buildingId`,`buildingCode`,`buildingName`,`unitId`,`unit`,`floor`,`number`)VALUES
        (#houseId#,
        (select id from main_project WHERE code = #projectCode# LIMIT 1),
        #buildCode#,
        #buildCode#,
        #buildingAbrev#,
        #unitId#,
        #unit#,
        #floor#,
        #roomNumber#)
    ]]>
    </entry>


    <!-- 获取同步相关配置 -->
    <entry key="sql.query.syncConfig">
        <![CDATA[
        select syncCode,syncEnv,pageSize,requestTime,syncCycle,requestCycle,nextSyncTime,lastRequestTime from sync_config
        where syncCode=#syncCode#
        ]]>
    </entry>

    <!-- 获取同步相关配置 -->
    <entry key="sql.update.syncConfig">
        <![CDATA[
        update sync_config set nextSyncTime = #nextSyncTime#,
        {? requestTime=#requestTime#,}
        lastRequestTime=#lastRequestTime#
        where syncCode=#syncCode#
        ]]>
    </entry>


    <!-- 查询同步失败条数 -->
    <entry key="sql.query.syncLog">
        <![CDATA[
        select id,buildingCode,projectCode from sync_log
        where 1=1
        and isSuccessed = 0
        and requestTime = #requestTime#
        and syncCode=#syncCode#
        limit 1
        ]]>
    </entry>

    <!-- 插入同步日志 -->
    <entry key="sql.insert.syncLog">
        <![CDATA[
        insert into sync_log(`id`,`syncCode`,`buildingCode`,`projectCode`,`editCount`,`newCount`,`curPage`,`msg`,`requestTime`,`syncTime`,`isSuccessed`,`createTime`)
        VALUES(#id#,#syncCode#,#buildingCode#,#projectCode#,#editCount#,#newCount#,#curPage#,#msg#,#requestTime#,#syncTime#,#isSuccessed#,NOW())
        ]]>
    </entry>


    <!-- 同步成功后更新日志信息 -->
    <entry key="sql.update.syncLog">
        <![CDATA[
        update sync_log set isSuccessed = 1
        where requestTime = #requestTime#
        and syncCode = #syncCode#
        and isSuccessed = 0
        ]]>
    </entry>

    <!-- 查询一个楼栋下的房屋编码 -->
    <entry key="sql.houseCode.byBuildingCode">
        <![CDATA[
        select `code` from main_house where buildingCode = #buildingCode#
        ]]>
    </entry>


    <!-- 更新房屋接管时间 -->
    <entry key="sql.update.takenovertime">
        <![CDATA[
        update  main_house set takeOverTime = #takenovertime# where buildingCode = #buildingCode#
        ]]>
    </entry>

    <!-- 查询系统管理员角色的用户ID -->
    <entry key="sql.query.systemmanagers">
        <![CDATA[
        select USER_ID from vankecrm_organization.sec_user_role where ROLE_ID='AD6754E3-B4D8-412D-9CD9-DC19DC42EBEA'
        ]]>
    </entry>


    <!-- 查询所有项目ID -->
    <entry key="sql.query.projectIds">
        <![CDATA[
        select id from main_project
        ]]>
    </entry>



    <!-- 查询所有项目ID -->
    <entry key="sql.exist.permission">
        <![CDATA[
        select count(1)  from mid_organization_user where organizationId = #organizationId# and userId = #userId#
        ]]>
    </entry>

    <!-- 查询所有项目ID -->
    <entry key="sql.insert.permission">
        <![CDATA[
        insert into mid_organization_user (`id`,`userId`,`organizationId`,`status`,`isDeleted`)
        VALUES(null,#userId#,#organizationId#,'1','0')
        ]]>
    </entry>


</properties>