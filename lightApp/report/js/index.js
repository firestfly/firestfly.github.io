var j = {
    "code": "200",
    "message": "sucess",
    "data": [{
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-28 00:00:00.0",
        "serialNumber": 3,
        "employerName": "rtgdfgfd",
        "roomNumber": "十分十分",
        "employerPhone": "13122222222",
        "decorationPerson": "是水电",
        "decorationUnit": "是的",
        "decorationPhone": "12345678912",
        "donstructionContent": "＠！＃￥％脸的的",
        "decorationBeginDate": "2016-04-28 00:00:00.0",
        "decorationEndDate": "2016-04-28 00:00:00.0",
        "incoherenceOfRecords": "佣兵6789087654！@#￥*（&",
        "emprAutoDate": "2016-05-03 00:00:00.0",
        "constructionUnit": null,
        "deUnAurDate": "2016-05-03 00:00:00.0",
        "propertyService": null,
        "propAuraDate": "2016-05-03 00:00:00.0",
        "remarks": "",
        "employerAutograph": null,
        "decorUnitAuraph": null,
        "propertyAuraph": null,
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "0",
        "employerAutographDate": null,
        "introducer": "王国金"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 5,
        "employerName": "测试专用5",
        "roomNumber": "福田区梅林路",
        "employerPhone": "15478963454",
        "decorationPerson": "万科物业5",
        "decorationUnit": "深圳万科物业52",
        "decorationPhone": "13051011022",
        "donstructionContent": "十分的",
        "decorationBeginDate": "2016-04-13 00:00:00.0",
        "decorationEndDate": "2016-04-13 00:00:00.0",
        "incoherenceOfRecords": "沙发",
        "emprAutoDate": "2016-04-19 00:00:00.0",
        "constructionUnit": "",
        "deUnAurDate": "2016-04-19 00:00:00.0",
        "propertyService": "",
        "propAuraDate": "2016-04-28 00:00:00.0",
        "remarks": "",
        "employerAutograph": "",
        "decorUnitAuraph": "",
        "propertyAuraph": "",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "test"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 6,
        "employerName": "测试专用6",
        "roomNumber": "福田区梅林路68号",
        "employerPhone": "15478963455",
        "decorationPerson": "万科物业6",
        "decorationUnit": "深圳万科物业6",
        "decorationPhone": "13051011022",
        "donstructionContent": "是",
        "decorationBeginDate": "2016-04-14 00:00:00.0",
        "decorationEndDate": "2016-04-14 00:00:00.0",
        "incoherenceOfRecords": "是",
        "emprAutoDate": "2016-04-12 00:00:00.0",
        "constructionUnit": "",
        "deUnAurDate": "2016-04-14 00:00:00.0",
        "propertyService": "",
        "propAuraDate": "2016-04-14 00:00:00.0",
        "remarks": "",
        "employerAutograph": "",
        "decorUnitAuraph": "",
        "propertyAuraph": "2016-4-14",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 7,
        "employerName": "测试专用7",
        "roomNumber": "福田区梅林路69号",
        "employerPhone": "15478963456",
        "decorationPerson": "万科物业7",
        "decorationUnit": "深圳万科物业7",
        "decorationPhone": "13051011022",
        "donstructionContent": "修负",
        "decorationBeginDate": "2016-04-20 00:00:00.0",
        "decorationEndDate": "2016-04-21 00:00:00.0",
        "incoherenceOfRecords": "修负",
        "emprAutoDate": "2016-04-18 00:00:00.0",
        "constructionUnit": "",
        "deUnAurDate": "2016-04-18 00:00:00.0",
        "propertyService": "",
        "propAuraDate": "2016-04-18 00:00:00.0",
        "remarks": "",
        "employerAutograph": "",
        "decorUnitAuraph": "",
        "propertyAuraph": "2016/4/18",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 8,
        "employerName": "测试专用8",
        "roomNumber": "福田区梅林路70号",
        "employerPhone": "uu",
        "decorationPerson": "万科物业8",
        "decorationUnit": "深圳万科物业8",
        "decorationPhone": "13422222222",
        "donstructionContent": "修负的",
        "decorationBeginDate": "2016-04-18 00:00:00.0",
        "decorationEndDate": "2016-04-18 00:00:00.0",
        "incoherenceOfRecords": "修负的",
        "emprAutoDate": "2016-04-18 00:00:00.0",
        "constructionUnit": "修负的",
        "deUnAurDate": "2016-04-18 00:00:00.0",
        "propertyService": "修负的",
        "propAuraDate": "2016-04-18 00:00:00.0",
        "remarks": "修负的",
        "employerAutograph": "",
        "decorUnitAuraph": "签字（章）： ",
        "propertyAuraph": "2016-4-18",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 9,
        "employerName": "测试专用9",
        "roomNumber": "福田区梅林路71号",
        "employerPhone": "15478963458",
        "decorationPerson": "万科物业9",
        "decorationUnit": "深圳万科物业9",
        "decorationPhone": "13139354560",
        "donstructionContent": "装修备案表测试数据导入！",
        "decorationBeginDate": "2016-04-18 00:00:00.0",
        "decorationEndDate": "2016-04-18 00:00:00.0",
        "incoherenceOfRecords": "未延迟",
        "emprAutoDate": "2016-04-18 00:00:00.0",
        "constructionUnit": "",
        "deUnAurDate": "2016-04-18 00:00:00.0",
        "propertyService": "",
        "propAuraDate": "2016-04-18 00:00:00.0",
        "remarks": "测试",
        "employerAutograph": "vanke_boss",
        "decorUnitAuraph": "vanke",
        "propertyAuraph": "vanke",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 10,
        "employerName": "测试专用哈哈",
        "roomNumber": "深圳市福田区梅林路72号万科大厦72号72深圳市福田区梅林路72号万科大厦72号72深圳市福田区梅林",
        "employerPhone": "15478963459",
        "decorationPerson": "万科物业10",
        "decorationUnit": "深圳万科物业10",
        "decorationPhone": "13601903063",
        "donstructionContent": "test10test",
        "decorationBeginDate": "2016-04-29 00:00:00.0",
        "decorationEndDate": "2016-04-30 00:00:00.0",
        "incoherenceOfRecords": "1施工延迟记录： ",
        "emprAutoDate": "2016-04-18 00:00:00.0",
        "constructionUnit": "身份证或委托",
        "deUnAurDate": "2016-04-18 00:00:00.0",
        "propertyService": "万科789458我是个好人",
        "propAuraDate": "2016-04-18 00:00:00.0",
        "remarks": "万科物业2016年4月10号",
        "employerAutograph": "万科",
        "decorUnitAuraph": "万科",
        "propertyAuraph": "2016-4-18",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 11,
        "employerName": "测试专用1",
        "roomNumber": "福田区梅林路73号",
        "employerPhone": "15478963460",
        "decorationPerson": "万科物业11",
        "decorationUnit": "深圳万科物业11",
        "decorationPhone": "13601903064",
        "donstructionContent": "sfdsf",
        "decorationBeginDate": "2016-04-21 00:00:00.0",
        "decorationEndDate": "2016-04-21 00:00:00.0",
        "incoherenceOfRecords": "sdfsf",
        "emprAutoDate": "2016-04-21 00:00:00.0",
        "constructionUnit": "",
        "deUnAurDate": "2016-04-21 00:00:00.0",
        "propertyService": "",
        "propAuraDate": "2016-04-21 00:00:00.0",
        "remarks": "",
        "employerAutograph": "",
        "decorUnitAuraph": "",
        "propertyAuraph": "",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 12,
        "employerName": "测试专用12",
        "roomNumber": "福田区梅林路74号",
        "employerPhone": "15478963461",
        "decorationPerson": "万科物业12",
        "decorationUnit": "深圳万科物业12",
        "decorationPhone": "13601903065",
        "donstructionContent": "ss",
        "decorationBeginDate": "2016-04-21 00:00:00.0",
        "decorationEndDate": "2016-04-21 00:00:00.0",
        "incoherenceOfRecords": "s",
        "emprAutoDate": "2016-04-21 00:00:00.0",
        "constructionUnit": "",
        "deUnAurDate": "2016-04-21 00:00:00.0",
        "propertyService": "",
        "propAuraDate": "2016-04-21 00:00:00.0",
        "remarks": "",
        "employerAutograph": "",
        "decorUnitAuraph": "",
        "propertyAuraph": "",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }, {
        "id": "VK-WY/TX08-K04-F1",
        "version": "V1.0",
        "effectDate": "2016-04-12 00:00:00.0",
        "serialNumber": 13,
        "employerName": "测试专用13",
        "roomNumber": "福田区梅林路75号",
        "employerPhone": "15478963462",
        "decorationPerson": "万科物业13",
        "decorationUnit": "深圳万科物业13",
        "decorationPhone": "13601903066",
        "donstructionContent": "dfdf",
        "decorationBeginDate": "2016-04-21 00:00:00.0",
        "decorationEndDate": "2016-04-21 00:00:00.0",
        "incoherenceOfRecords": "df",
        "emprAutoDate": "2016-04-21 00:00:00.0",
        "constructionUnit": "",
        "deUnAurDate": "2016-04-21 00:00:00.0",
        "propertyService": "",
        "propAuraDate": "2016-04-21 00:00:00.0",
        "remarks": "",
        "employerAutograph": "",
        "decorUnitAuraph": "",
        "propertyAuraph": "",
        "pagesize": 0,
        "page": 0,
        "bigein": 0,
        "isprint": "1",
        "employerAutographDate": null,
        "introducer": "江泽民萌萌哒"
    }],
    "rowCount": "82",
    "pagesize": 10,
    "page": 1
};
var dataArray = j.data;
var vm = avalon.define({
    $id: "dataTable",
    page: 1,
    pagesize: 10,
    pageNumber: [0],
    allItems: 10,
    dataArray: dataArray,
    searchText: "",
    employerName: "",
    roomNumber: "",
    employerPhone: "",
    serialNumber: "",
    choices: [],
    searchOption: "employerName",
    changePageSize: function () {
        vm.page = 1;
        // 更改显示记录条数
        getData(ajaxUrlConfig.initCecoRecor, vm.page, this.value, vm.searchText);
        vm.pagesize = this.value;
    },
    pageIndex: function (index) {
        // 分页查询
        if (index !== vm.page && index <= vm.pageNumber.size()) {
            vm.page = index;
            getData(ajaxUrlConfig.initCecoRecor, vm.page, vm.pagesize, vm.searchText);
        }
    },
    pagePrev: function () {
        // 跳转到上一页
        if (vm.page > 1) {
            vm.page = vm.page - 1;
            getData(ajaxUrlConfig.initCecoRecor, vm.page, vm.pagesize, vm.searchText);
        }
    },
    print: function () {
        window.print();
    },
    check: function (index, isprint) {
        // 查看单个表单数据
        var txt;
        if (document.selection) {
            txt = document.selection.createRange().text
        } else {
            txt = window.getSelection() + '';
        }
        if (txt || isprint == 1) return;
        window.localStorage.serialNumber = vm.$model.dataArray[index]["serialNumber"];
        location.href = "record.html?editeList=1";
    },
    sortBy: function (item) {
        var _this = this;
        _this._clickCount = _this._clickCount ? 0 : 1;
        vm.dataArray.sort(function (a, b) {
            if (_this._clickCount) {
                $(_this).find("i").removeClass("icon-caret-down").addClass("icon-caret-up");
                return a[item] > b[item];
            } else {
                $(_this).find("i").removeClass("icon-caret-up").addClass("icon-caret-down");
                return a[item] <= b[item];
            }
        })
    },
    checkAllbool: false,
    checkAll: function () {
        if (this.checked) {
            for (var i = 0, m = vm.$model.dataArray, len = m.length; i < len; i++) {
                if ("serialNumber" in m[i])
                    vm.choices.push("" + m[i]["serialNumber"]);
            }
        } else {
            vm.choices.clear();
        }
    },
    dels: function () {
        var choices = vm.choices.$model;
        if (choices.length) {
            $.prompt("是否确认删除选择的列表行？", {
                //title: "是否确认删除？ ",
                buttons: {"删&nbsp;除": true, "取&nbsp;消": false},
                persistent: false,
                submit: function (e, v, m, f) {
                    if (v) {
                        //e.preventDefault();
                        $.ajax({
                            method: "DELETE",
                            url: "/DecorationForm/initCecoRecor",
                            dataType: "json",
                            data: {
                                serialNumber: choices
                            },
                            contentType: "application/json",
                            processData: false,
                            success: function (data) {
                                if (data.code == "200") {
                                    $.prompt("删除成功", {
                                        title: "提示",
                                        buttons: {"确定": false}
                                    });
                                }
                            }
                        })
                    }
                }
            });
        }

    },
    remove: function (index, rem, ev) {
        //vm.dataArray.splice(index, 1);
        ev.stopPropagation();
        var serialNumber = vm.$model.dataArray[index].serialNumber;
        if (serialNumber) {
            $.prompt("确认对话框", {
                //title: "是否确认删除？ ",
                buttons: {"删&nbsp;除": true, "取&nbsp;消": false},
                persistent: false,
                submit: function (e, v, m, f) {
                    if (v) {
                        //e.preventDefault();
                        $.ajax({
                            method: "DELETE",
                            url: "/DecorationForm/initCecoRecor?serialNumber=" + serialNumber,
                            dataType: "json",
                            success: function (data) {
                                rem();
                                if (data.code == "200") {
                                    $.prompt("删除成功!");
                                }
                            }
                        })
                    }
                }
            });

        }
    }
})
vm.checkAllbool = vm.dataArray.length === vm.choices.length;
vm.$watch("choices.length", function (n) {
    vm.checkAllbool = n === vm.dataArray.size();
})
getData(ajaxUrlConfig.initCecoRecor, 1, 10, "");

// 监听搜索字段
vm.$watch("employerName", function (v) {
    getData(ajaxUrlConfig.initCecoRecor, 1, vm.pagesize);
})
vm.$watch("roomNumber", function (v) {
    getData(ajaxUrlConfig.initCecoRecor, 1, vm.pagesize);
})
vm.$watch("employerPhone", function (v) {
    getData(ajaxUrlConfig.initCecoRecor, 1, vm.pagesize);
})
vm.$watch("serialNumber", function (v) {
    getData(ajaxUrlConfig.initCecoRecor, 1, vm.pagesize);
})
// 获取数据
/*
 ** url:请求地址
 ** page：页码
 ** pagesize：每页记录条数
 ** searchText: 搜索内容
 */
function getData(url, page, pagesize, searchText) {
    //编码必须拼接在url上？？？
    //url += "?" + vm.searchOption + "=" + encodeURIComponent(encodeURIComponent(searchText));
    $.ajax({
        method: "GET",
        url: url,
        dataType: "json",
        data: {
            page: page,
            pagesize: pagesize,
            employerName: vm.employerName,
            roomNumber: vm.roomNumber,
            employerPhone: vm.employerPhone,
            serialNumber: vm.serialNumber
        },
        success: function (data) {
            dataArray = data["data"];
            vm.dataArray = dataArray.slice(0, pagesize);
            vm.pageNumber = avalon.range(Math.ceil(data.rowCount / vm.pagesize));
            vm.allItems = data.rowCount;
        }
    })
}
